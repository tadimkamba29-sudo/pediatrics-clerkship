<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Pediatrics Clerkship Sheet</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary-color: #2c3e50; --secondary-color: #3498db; --accent-color: #e74c3c;
            --success-color: #27ae60; --warning-color: #f39c12; --bg-color: #ecf0f1;
            --card-bg: #ffffff; --text-color: #2c3e50; --text-secondary: #7f8c8d;
            --border-color: #bdc3c7; --input-bg: #ffffff; --input-border: #dfe6e9;
            --shadow: rgba(0,0,0,0.08); --shadow-hover: rgba(0,0,0,0.15);
        }
        @media (prefers-color-scheme: dark) {
            :root {
                --primary-color: #e8eaed; --secondary-color: #8ab4f8; --accent-color: #f28b82;
                --success-color: #81c995; --warning-color: #fdd663; --bg-color: #202124;
                --card-bg: #292a2d; --text-color: #e8eaed; --text-secondary: #9aa0a6;
                --border-color: #3c4043; --input-bg: #3c4043; --input-border: #5f6368;
                --shadow: rgba(0,0,0,0.3); --shadow-hover: rgba(0,0,0,0.5);
            }
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: var(--bg-color); color: var(--text-color); line-height: 1.6; padding-bottom: 80px; }
        .header { background: linear-gradient(135deg, #2c3e50, #3498db); color: white; padding: 15px; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px var(--shadow); }
        @media (prefers-color-scheme: dark) { .header { background: linear-gradient(135deg, #1a1a1a, #2c5282); } }
        .header h1 { font-size: 1.3rem; font-weight: 600; }
        .header-subtitle { font-size: 0.85rem; opacity: 0.9; margin-top: 3px; }
        .header-meta { font-size: 0.78rem; opacity: 0.7; margin-top: 4px; }
        .progress-bar { width: 100%; height: 4px; background: rgba(255,255,255,0.3); margin-top: 10px; border-radius: 2px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--success-color); width: 0%; transition: width 0.3s ease; }
        .nav-tabs { display: flex; overflow-x: auto; background: var(--card-bg); border-bottom: 2px solid var(--border-color); position: sticky; top: 72px; z-index: 999; scrollbar-width: none; -webkit-overflow-scrolling: touch; }
        .nav-tabs::-webkit-scrollbar { display: none; }
        .nav-tab { padding: 12px 20px; white-space: nowrap; border: none; background: none; cursor: pointer; font-size: 0.9rem; color: var(--text-color); border-bottom: 3px solid transparent; transition: all 0.3s; flex-shrink: 0; }
        .nav-tab.active { color: var(--secondary-color); border-bottom-color: var(--secondary-color); font-weight: 600; }
        .nav-tab:hover { background: var(--bg-color); }
        .container { max-width: 1200px; margin: 0 auto; padding: 15px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card { background: var(--card-bg); border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px var(--shadow); border: 1px solid var(--border-color); transition: box-shadow 0.3s ease; }
        .card:hover { box-shadow: 0 4px 12px var(--shadow-hover); }
        .card-title { font-size: 1.1rem; font-weight: 600; color: var(--text-color); margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid var(--border-color); display: flex; align-items: center; }
        .card-title::before { content: ''; width: 4px; height: 20px; background: var(--secondary-color); margin-right: 10px; border-radius: 2px; }
        .form-group { margin-bottom: 18px; }
        label { display: block; font-size: 0.9rem; font-weight: 500; color: var(--text-color); margin-bottom: 6px; }
        label.required::after { content: ' *'; color: var(--accent-color); }
        input[type="text"], input[type="number"], input[type="date"], input[type="time"], input[type="datetime-local"], input[type="tel"], select, textarea {
            width: 100%; padding: 12px; border: 1px solid var(--input-border); border-radius: 8px; font-size: 1rem; font-family: inherit; background: var(--input-bg); color: var(--text-color); transition: all 0.3s; -webkit-appearance: none; appearance: none;
        }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--secondary-color); box-shadow: 0 0 0 3px rgba(52,152,219,0.1); }
        input::placeholder, textarea::placeholder { color: var(--text-secondary); opacity: 0.7; }
        textarea { min-height: 100px; resize: vertical; }
        select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 9L1 4h10z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; padding-right: 35px; }
        @media (prefers-color-scheme: dark) { select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23e8eaed' d='M6 9L1 4h10z'/%3E%3C/svg%3E"); } }
        input:read-only { background: var(--bg-color); cursor: not-allowed; opacity: 0.7; }
        .checkbox-group, .radio-group { display: flex; flex-wrap: wrap; gap: 15px; }
        .checkbox-item, .radio-item { display: flex; align-items: center; cursor: pointer; padding: 8px 12px; border-radius: 6px; transition: background 0.2s; }
        .checkbox-item:hover, .radio-item:hover { background: var(--bg-color); }
        input[type="checkbox"], input[type="radio"] { width: 20px; height: 20px; margin-right: 8px; cursor: pointer; accent-color: var(--secondary-color); }
        .form-row { display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media (min-width: 768px) {
            .form-row { grid-template-columns: repeat(2, 1fr); }
            .form-row.three-col { grid-template-columns: repeat(3, 1fr); }
            .form-row.four-col { grid-template-columns: repeat(4, 1fr); }
        }
        .table-responsive { overflow-x: auto; -webkit-overflow-scrolling: touch; margin: 0 -10px; padding: 0 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        table th { background: var(--bg-color); padding: 10px; text-align: left; font-weight: 600; border-bottom: 2px solid var(--border-color); color: var(--text-color); white-space: nowrap; }
        table td { padding: 10px; border-bottom: 1px solid var(--border-color); }
        table input, table select, table textarea { padding: 8px; font-size: 0.9rem; }
        table tr:hover { background: var(--bg-color); }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 500; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: #3498db; color: white; }
        .btn-primary:hover { background: #2980b9; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(52,152,219,0.3); }
        .btn-success { background: #27ae60; color: white; }
        .btn-success:hover { background: #229954; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-danger:hover { background: #c0392b; }
        .btn-secondary { background: var(--border-color); color: var(--text-color); }
        .btn-secondary:hover { background: #95a5a6; }
        .btn-outline { background: transparent; border: 2px solid var(--secondary-color); color: var(--secondary-color); }
        .btn-outline:hover { background: var(--secondary-color); color: white; }
        .btn:active { transform: scale(0.98); }
        @media (prefers-color-scheme: dark) {
            .btn-primary { background: #8ab4f8; color: #202124; } .btn-primary:hover { background: #aac8fc; }
            .btn-success { background: #81c995; color: #202124; } .btn-success:hover { background: #9dd4ab; }
            .btn-danger { background: #f28b82; color: #202124; } .btn-danger:hover { background: #f5a79d; }
            .btn-outline:hover { color: #202124; }
        }
        .action-buttons { position: fixed; bottom: 0; left: 0; right: 0; background: var(--card-bg); padding: 15px; box-shadow: 0 -2px 10px var(--shadow); display: flex; gap: 10px; z-index: 998; border-top: 1px solid var(--border-color); }
        .action-buttons .btn { flex: 1; }
        .alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid; }
        .alert-info { background: rgba(52,152,219,0.1); border-color: var(--secondary-color); color: var(--text-color); }
        .alert-warning { background: rgba(243,156,18,0.1); border-color: var(--warning-color); color: var(--text-color); }
        .alert-danger { background: rgba(231,76,60,0.1); border-color: var(--accent-color); color: var(--text-color); }
        .alert-success { background: rgba(39,174,96,0.1); border-color: var(--success-color); color: var(--text-color); }
        @media (prefers-color-scheme: dark) {
            .alert-info { background: rgba(138,180,248,0.15); } .alert-warning { background: rgba(253,214,99,0.15); }
            .alert-danger { background: rgba(242,139,130,0.15); } .alert-success { background: rgba(129,201,149,0.15); }
        }
        .diff-dx-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(102,126,234,0.3); }
        @media (prefers-color-scheme: dark) { .diff-dx-card { background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%); } }
        .diff-dx-card h3 { margin-bottom: 15px; font-size: 1.2rem; }
        .diff-dx-item { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); padding: 15px; border-radius: 8px; margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.2); }
        .diff-dx-item input, .diff-dx-item textarea, .diff-dx-item select { background: rgba(255,255,255,0.95); color: #2c3e50; }
        @media (prefers-color-scheme: dark) { .diff-dx-item input, .diff-dx-item textarea, .diff-dx-item select { background: #3c4043; color: #e8eaed; } }
        .diff-dx-item h4 { color: white; }
        .badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 0.8rem; font-weight: 600; margin-left: 8px; }
        .badge-primary { background: var(--secondary-color); color: white; }
        .badge-danger { background: var(--accent-color); color: white; }
        .badge-success { background: var(--success-color); color: white; }
        @media (prefers-color-scheme: dark) {
            .badge-primary { background: #8ab4f8; color: #202124; } .badge-danger { background: #f28b82; color: #202124; }
            .badge-success { background: #81c995; color: #202124; }
        }
        .autosave-indicator { position: fixed; top: 80px; right: 15px; background: var(--success-color); color: white; padding: 8px 15px; border-radius: 20px; font-size: 0.85rem; display: none; z-index: 1000; box-shadow: 0 2px 8px var(--shadow); transition: all 0.3s; }
        .autosave-indicator.saving { background: var(--warning-color); }
        @media (prefers-color-scheme: dark) { .autosave-indicator { background: #81c995; color: #202124; } .autosave-indicator.saving { background: #fdd663; color: #202124; } }
        .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: var(--card-bg); color: var(--text-color); padding: 15px 25px; border-radius: 8px; box-shadow: 0 4px 12px var(--shadow-hover); z-index: 10000; display: none; animation: slideUp 0.3s ease; border: 1px solid var(--border-color); max-width: 340px; text-align: center; }
        @keyframes slideUp { from { transform: translate(-50%, 100px); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }
        .toast.show { display: block; }
        .growth-display { display: flex; justify-content: space-around; margin-top: 10px; gap: 10px; }
        .growth-item { text-align: center; padding: 10px; background: var(--bg-color); border-radius: 8px; flex: 1; border: 1px solid var(--border-color); }
        .growth-value { font-size: 1.5rem; font-weight: 600; color: var(--secondary-color); }
        .growth-label { font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px; }
        .add-row-btn { background: var(--success-color); color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; margin-top: 10px; transition: all 0.3s; }
        .add-row-btn:hover { background: #229954; transform: translateY(-1px); }
        @media (prefers-color-scheme: dark) { .add-row-btn { background: #81c995; color: #202124; } .add-row-btn:hover { background: #9dd4ab; } }
        .remove-row-btn { background: var(--accent-color); color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; transition: all 0.3s; }
        .remove-row-btn:hover { background: #c0392b; }
        @media (prefers-color-scheme: dark) { .remove-row-btn { background: #f28b82; color: #202124; } .remove-row-btn:hover { background: #f5a79d; } }
        .vital-indicator { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-left: 8px; }
        .vital-normal { background: var(--success-color); }
        .vital-warning { background: var(--warning-color); }
        .vital-danger { background: var(--accent-color); }
        .summary-panel { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(102,126,234,0.3); }
        @media (prefers-color-scheme: dark) { .summary-panel { background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%); } }
        .summary-item { margin-bottom: 10px; font-size: 0.95rem; }
        .summary-item strong { display: inline-block; width: 120px; opacity: 0.9; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-color); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-secondary); }
        *:focus-visible { outline: 2px solid var(--secondary-color); outline-offset: 2px; }
        @media (prefers-color-scheme: dark) { label { color: #e8eaed; } .card { border: 1px solid #3c4043; } table th { background: #3c4043; color: #e8eaed; } input::placeholder, textarea::placeholder { color: #9aa0a6; } }
        @media (max-width: 767px) { .container { padding: 10px; } .card { padding: 15px; margin-bottom: 15px; } .header h1 { font-size: 1.1rem; } .nav-tab { padding: 10px 15px; font-size: 0.85rem; } .btn { padding: 10px 20px; font-size: 0.95rem; } table { font-size: 0.85rem; } table th, table td { padding: 8px 6px; } }
        @media print {
            body { background: white; color: black; }
            .header { position: static !important; }
            .nav-tabs, .action-buttons, .autosave-indicator, .btn, .remove-row-btn, .add-row-btn { display: none !important; }
            .card { break-inside: avoid; box-shadow: none; border: 1px solid #ddd; page-break-inside: avoid; }
            .tab-content { display: block !important; }
            input, select, textarea { border: none; border-bottom: 1px solid #ddd; background: transparent; }
        }
    </style>
</head>
<body>

<!-- Header -->
<div class="header">
    <h1>Pediatrics Clerkship Sheet</h1>
    <div class="header-subtitle">Universal Clinical Documentation Tool</div>
    <div class="header-meta" id="lastSavedMeta"></div>
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
</div>

<div class="autosave-indicator" id="autosaveIndicator">‚úì Saved</div>

<div class="nav-tabs" id="navTabs">
    <button class="nav-tab active" onclick="showTab('patient-info', this)">Patient Info</button>
    <button class="nav-tab" onclick="showTab('chief-complaint', this)">Chief Complaint</button>
    <button class="nav-tab" onclick="showTab('past-medical', this)">Past Medical Hx</button>
    <button class="nav-tab" onclick="showTab('family-social', this)">Family/Social Hx</button>
    <button class="nav-tab" onclick="showTab('diff-dx-history', this)">‚≠ê Diff Dx (History)</button>
    <button class="nav-tab" onclick="showTab('physical-exam', this)">Physical Exam</button>
    <button class="nav-tab" onclick="showTab('diff-dx-final', this)">‚≠ê Diff Dx (Final)</button>
    <button class="nav-tab" onclick="showTab('investigations', this)">Investigations</button>
    <button class="nav-tab" onclick="showTab('management', this)">Management</button>
    <button class="nav-tab" onclick="showTab('progress', this)">Progress Notes</button>
    <button class="nav-tab" onclick="showTab('neonatal', this)">üë∂ Neonatal</button>
</div>

<div class="container">

<!-- TAB 1: PATIENT INFORMATION -->
<div id="patient-info" class="tab-content active">
    <div class="card">
        <h2 class="card-title">Patient Identification</h2>
        <div class="form-row">
            <div class="form-group"><label for="patientName" class="required">Patient Name</label><input type="text" id="patientName" placeholder="Full name"></div>
            <div class="form-group"><label for="mrn">Medical Record No.</label><input type="text" id="mrn" placeholder="MRN"></div>
        </div>
        <div class="form-row three-col">
            <div class="form-group"><label for="dob" class="required">Date of Birth</label><input type="date" id="dob" onchange="calculateAge()"></div>
            <div class="form-group"><label>Age</label><input type="text" id="age" readonly placeholder="Auto-calculated"></div>
            <div class="form-group"><label for="sex" class="required">Sex</label><select id="sex"><option value="">Select...</option><option value="male">Male</option><option value="female">Female</option><option value="ambiguous">Ambiguous</option></select></div>
        </div>
        <div class="form-row three-col">
            <div class="form-group"><label for="weight" class="required">Weight (kg)</label><input type="number" id="weight" step="0.1" placeholder="0.0" onchange="calculateGrowth()"></div>
            <div class="form-group"><label for="height" class="required">Height (cm)</label><input type="number" id="height" step="0.1" placeholder="0.0" onchange="calculateGrowth()"></div>
            <div class="form-group"><label for="headCirc">Head Circumference (cm)</label><input type="number" id="headCirc" step="0.1" placeholder="0.0"></div>
        </div>
        <div class="growth-display" id="growthDisplay" style="display:none;">
            <div class="growth-item"><div class="growth-value" id="bmiValue">--</div><div class="growth-label">BMI</div></div>
            <div class="growth-item"><div class="growth-value" id="wfaPercentile">--</div><div class="growth-label">Wt Percentile</div></div>
            <div class="growth-item"><div class="growth-value" id="hfaPercentile">--</div><div class="growth-label">Ht Percentile</div></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="admissionDate">Date of Admission</label><input type="date" id="admissionDate"></div>
            <div class="form-group"><label for="admissionTime">Time of Admission</label><input type="time" id="admissionTime"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="informant">Informant</label><select id="informant"><option value="">Select...</option><option value="mother">Mother</option><option value="father">Father</option><option value="guardian">Guardian</option><option value="other">Other</option></select></div>
            <div class="form-group"><label for="reliability">Reliability of Informant</label><select id="reliability"><option value="">Select...</option><option value="reliable">Reliable</option><option value="fairly">Fairly Reliable</option><option value="unreliable">Unreliable</option></select></div>
        </div>
        <div class="form-group"><label for="attendingPhysician">Attending Physician</label><input type="text" id="attendingPhysician" placeholder="Dr. Name"></div>
    </div>
</div>

<!-- TAB 2: CHIEF COMPLAINT & HPI -->
<div id="chief-complaint" class="tab-content">
    <div class="card">
        <h2 class="card-title">Chief Complaint(s)</h2>
        <div class="alert alert-info">Record in the patient's/caregiver's own words, with duration</div>
        <div class="form-group"><label for="complaint1" class="required">Complaint 1</label><input type="text" id="complaint1" placeholder="e.g., 'High fever'"></div>
        <div class="form-group"><label for="duration1">Duration</label><input type="text" id="duration1" placeholder="e.g., '3 days'"></div>
        <div class="form-group"><label for="complaint2">Complaint 2</label><input type="text" id="complaint2"></div>
        <div class="form-group"><label for="duration2">Duration</label><input type="text" id="duration2"></div>
        <div class="form-group"><label for="complaint3">Complaint 3</label><input type="text" id="complaint3"></div>
        <div class="form-group"><label for="duration3">Duration</label><input type="text" id="duration3"></div>
    </div>
    <div class="card">
        <h2 class="card-title">History of Present Illness</h2>
        <div class="form-group"><label for="hpiNarrative" class="required">Detailed Chronological Narrative</label><textarea id="hpiNarrative" rows="8" placeholder="Describe the illness chronologically from onset to presentation..."></textarea></div>
        <h3 style="margin:20px 0 15px;color:var(--secondary-color);">Symptom Characterization (Main Complaint)</h3>
        <div class="form-row">
            <div class="form-group"><label for="onset">Onset</label><select id="onset"><option value="">Select...</option><option value="sudden">Sudden</option><option value="gradual">Gradual</option></select></div>
            <div class="form-group"><label for="onsetDateTime">Date/Time Started</label><input type="datetime-local" id="onsetDateTime"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="location">Location</label><input type="text" id="location" placeholder="Where is the symptom?"></div>
            <div class="form-group"><label for="character">Character</label><input type="text" id="character" placeholder="What does it feel like?"></div>
        </div>
        <div class="form-group"><label for="aggravatingFactors">Aggravating Factors</label><input type="text" id="aggravatingFactors" placeholder="What makes it worse?"></div>
        <div class="form-group"><label for="relievingFactors">Relieving Factors</label><input type="text" id="relievingFactors" placeholder="What makes it better?"></div>
        <div class="form-row">
            <div class="form-group"><label for="timing">Timing/Frequency</label><select id="timing"><option value="">Select...</option><option value="constant">Constant</option><option value="intermittent">Intermittent</option><option value="pattern">Pattern (describe below)</option></select></div>
            <div class="form-group"><label for="severity">Severity</label><select id="severity"><option value="">Select...</option><option value="mild">Mild</option><option value="moderate">Moderate</option><option value="severe">Severe</option></select></div>
        </div>
        <div class="form-group"><label for="progression">Progression</label><select id="progression"><option value="">Select...</option><option value="better">Getting Better</option><option value="worse">Getting Worse</option><option value="same">Staying the Same</option></select></div>
        <div class="form-group"><label for="associatedSymptoms">Associated Symptoms</label><textarea id="associatedSymptoms" rows="3"></textarea></div>
        <h3 style="margin:20px 0 15px;color:var(--secondary-color);">Effect on Function</h3>
        <div class="form-row three-col">
            <div class="form-group"><label for="effectFeeding">On Feeding</label><input type="text" id="effectFeeding"></div>
            <div class="form-group"><label for="effectSleep">On Sleep</label><input type="text" id="effectSleep"></div>
            <div class="form-group"><label for="effectActivity">On Activity</label><input type="text" id="effectActivity"></div>
        </div>
        <div class="form-group"><label for="pertinentPositives">Pertinent Positives</label><textarea id="pertinentPositives" rows="3"></textarea></div>
        <div class="form-group"><label for="pertinentNegatives">Pertinent Negatives</label><textarea id="pertinentNegatives" rows="3"></textarea></div>
    </div>
    <div class="card">
        <h2 class="card-title">Prior Treatment for This Episode</h2>
        <div class="table-responsive">
            <table id="priorTreatmentTable"><thead><tr><th>Medication/Intervention</th><th>Dose</th><th>Duration</th><th>Response</th><th></th></tr></thead>
            <tbody><tr><td><input type="text" placeholder="Medication"></td><td><input type="text" placeholder="Dose"></td><td><input type="text" placeholder="Duration"></td><td><input type="text" placeholder="Response"></td><td><button class="remove-row-btn" onclick="removeRow(this)">√ó</button></td></tr></tbody></table>
        </div>
        <button class="add-row-btn" onclick="addTreatmentRow()">+ Add Treatment</button>
    </div>
    <div class="card">
        <h2 class="card-title">Review of Systems</h2>
        <div class="alert alert-info">Check boxes for positive findings and elaborate in details below</div>
        <h3 style="margin:15px 0 10px;font-size:1rem;color:var(--primary-color);">General/Constitutional</h3>
        <div class="checkbox-group">
            <label class="checkbox-item"><input type="checkbox" name="ros" value="fever"> Fever</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="weight-loss"> Weight loss/gain</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="fatigue"> Fatigue/lethargy</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="poor-appetite"> Poor appetite</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="irritability"> Irritability</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="ftt"> Failure to thrive</label>
        </div>
        <h3 style="margin:15px 0 10px;font-size:1rem;color:var(--primary-color);">Respiratory</h3>
        <div class="checkbox-group">
            <label class="checkbox-item"><input type="checkbox" name="ros" value="cough"> Cough</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="difficulty-breathing"> Difficulty breathing</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="wheezing"> Wheezing</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="stridor"> Stridor</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="cyanosis"> Cyanosis</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="chest-pain"> Chest pain</label>
        </div>
        <h3 style="margin:15px 0 10px;font-size:1rem;color:var(--primary-color);">Gastrointestinal</h3>
        <div class="checkbox-group">
            <label class="checkbox-item"><input type="checkbox" name="ros" value="vomiting"> Vomiting</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="diarrhea"> Diarrhea</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="constipation"> Constipation</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="abd-pain"> Abdominal pain</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="jaundice"> Jaundice</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="bloody-stool"> Bloody stool</label>
        </div>
        <h3 style="margin:15px 0 10px;font-size:1rem;color:var(--primary-color);">Neurological</h3>
        <div class="checkbox-group">
            <label class="checkbox-item"><input type="checkbox" name="ros" value="seizures"> Seizures</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="headache"> Headache</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="altered-sensorium"> Altered sensorium</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="weakness"> Weakness</label>
        </div>
        <h3 style="margin:15px 0 10px;font-size:1rem;color:var(--primary-color);">Genitourinary</h3>
        <div class="checkbox-group">
            <label class="checkbox-item"><input type="checkbox" name="ros" value="dysuria"> Dysuria</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="polyuria"> Polyuria</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="oliguria"> Oliguria</label>
            <label class="checkbox-item"><input type="checkbox" name="ros" value="hematuria"> Hematuria</label>
        </div>
        <div class="form-group" style="margin-top:20px;"><label for="rosDetails">Details of Positive Findings</label><textarea id="rosDetails" rows="4" placeholder="Elaborate on any checked items above..."></textarea></div>
    </div>
</div>

<!-- TAB 3: PAST MEDICAL HISTORY -->
<div id="past-medical" class="tab-content">
    <div class="card">
        <h2 class="card-title">Birth &amp; Perinatal History</h2>
        <h3 style="margin:15px 0 10px;color:var(--secondary-color);">Antenatal</h3>
        <div class="form-row four-col">
            <div class="form-group"><label for="gravida">Gravida</label><input type="number" id="gravida" min="0"></div>
            <div class="form-group"><label for="para">Para</label><input type="number" id="para" min="0"></div>
            <div class="form-group"><label for="abortus">Abortus</label><input type="number" id="abortus" min="0"></div>
            <div class="form-group"><label for="living">Living</label><input type="number" id="living" min="0"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="antenatalCare">Antenatal Care</label><select id="antenatalCare"><option value="">Select...</option><option value="regular">Regular</option><option value="irregular">Irregular</option><option value="none">None</option></select></div>
            <div class="form-group"><label for="ancVisits">Number of Visits</label><input type="number" id="ancVisits" min="0"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="maternalBloodGroup">Maternal Blood Group</label><select id="maternalBloodGroup"><option value="">Select...</option><option>A</option><option>B</option><option>AB</option><option>O</option></select></div>
            <div class="form-group"><label for="maternalRh">Rh</label><select id="maternalRh"><option value="">Select...</option><option value="positive">Positive</option><option value="negative">Negative</option></select></div>
        </div>
        <div class="form-group"><label>Maternal Illnesses During Pregnancy</label>
            <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" name="maternal-illness" value="none"> None</label>
                <label class="checkbox-item"><input type="checkbox" name="maternal-illness" value="gdm"> GDM</label>
                <label class="checkbox-item"><input type="checkbox" name="maternal-illness" value="htn"> HTN/Pre-eclampsia</label>
                <label class="checkbox-item"><input type="checkbox" name="maternal-illness" value="infections"> Infections</label>
                <label class="checkbox-item"><input type="checkbox" name="maternal-illness" value="thyroid"> Thyroid disease</label>
            </div>
        </div>
        <div class="form-group"><label for="maternalMeds">Medications During Pregnancy</label><input type="text" id="maternalMeds" placeholder="List medications"></div>
        <h3 style="margin:25px 0 10px;color:var(--secondary-color);">Natal</h3>
        <div class="form-row">
            <div class="form-group"><label for="gestationalAge">Gestational Age at Birth (weeks)</label><input type="number" id="gestationalAge" step="0.1" min="20" max="45"></div>
            <div class="form-group"><label for="deliveryPlace">Place of Delivery</label><select id="deliveryPlace"><option value="">Select...</option><option value="hospital">Hospital</option><option value="home">Home</option><option value="other">Other</option></select></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="deliveryMode">Mode of Delivery</label><select id="deliveryMode"><option value="">Select...</option><option value="svd">SVD</option><option value="csection">C-section</option><option value="assisted">Assisted (vacuum/forceps)</option></select></div>
            <div class="form-group" id="csectionIndicationGroup" style="display:none;"><label for="csectionIndication">C-section Indication</label><input type="text" id="csectionIndication"></div>
        </div>
        <h3 style="margin:25px 0 10px;color:var(--secondary-color);">Neonatal</h3>
        <div class="form-row three-col">
            <div class="form-group"><label for="birthWeight">Birth Weight (kg)</label><input type="number" id="birthWeight" step="0.01" min="0"></div>
            <div class="form-group"><label for="birthLength">Birth Length (cm)</label><input type="number" id="birthLength" step="0.1" min="0"></div>
            <div class="form-group"><label for="birthHC">Birth Head Circ (cm)</label><input type="number" id="birthHC" step="0.1" min="0"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="criedImmediately">Cried Immediately</label><select id="criedImmediately"><option value="">Select...</option><option value="yes">Yes</option><option value="no">No</option></select></div>
            <div class="form-group"><label>Resuscitation Needed</label>
                <div class="checkbox-group">
                    <label class="checkbox-item"><input type="checkbox" name="resuscitation" value="none"> None</label>
                    <label class="checkbox-item"><input type="checkbox" name="resuscitation" value="bag-mask"> Bag-mask</label>
                    <label class="checkbox-item"><input type="checkbox" name="resuscitation" value="intubation"> Intubation</label>
                </div>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="nicuAdmission">NICU Admission</label><select id="nicuAdmission"><option value="">Select...</option><option value="yes">Yes</option><option value="no">No</option></select></div>
            <div class="form-group" id="nicuReasonGroup" style="display:none;"><label for="nicuReason">Reason &amp; Duration</label><input type="text" id="nicuReason" placeholder="Reason and duration"></div>
        </div>
    </div>
    <div class="card">
        <h2 class="card-title">Feeding History</h2>
        <div class="form-group"><label for="currentFeeding">Current Feeding</label><select id="currentFeeding"><option value="">Select...</option><option value="exclusive-bf">Exclusive Breastfeeding</option><option value="formula">Formula Feeding</option><option value="mixed">Mixed Feeding</option><option value="complementary">Complementary Foods</option><option value="family-diet">Family Diet</option></select></div>
        <div class="form-row">
            <div class="form-group"><label for="exclusiveBfDuration">Duration of Exclusive BF (months)</label><input type="number" id="exclusiveBfDuration" min="0" step="0.5"></div>
            <div class="form-group"><label for="complementaryAge">Age Complementary Feeding Started (months)</label><input type="number" id="complementaryAge" min="0" step="0.5"></div>
        </div>
        <div class="form-group"><label for="dietRecall">24-Hour Dietary Recall</label><textarea id="dietRecall" rows="5" placeholder="Breakfast:&#10;Lunch:&#10;Dinner:&#10;Snacks:"></textarea></div>
        <div class="form-group"><label for="foodAllergies">Food Allergies/Intolerances</label><input type="text" id="foodAllergies" placeholder="None or specify"></div>
        <div class="form-group"><label>Vitamins/Supplements</label>
            <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" name="supplements" value="vit-d"> Vitamin D</label>
                <label class="checkbox-item"><input type="checkbox" name="supplements" value="iron"> Iron</label>
                <label class="checkbox-item"><input type="checkbox" name="supplements" value="multivitamin"> Multivitamin</label>
            </div>
        </div>
    </div>
    <div class="card">
        <h2 class="card-title">Developmental Milestones</h2>
        <div class="alert alert-info">Record age achieved for key milestones</div>
        <h3 style="margin:15px 0 10px;font-size:1rem;color:var(--primary-color);">Gross Motor</h3>
        <div class="form-row three-col">
            <div class="form-group"><label for="milestoneSitting">Sitting (months)</label><input type="number" id="milestoneSitting" step="0.5" placeholder="Expected: 6-8"></div>
            <div class="form-group"><label for="milestoneStanding">Standing (months)</label><input type="number" id="milestoneStanding" step="0.5" placeholder="Expected: 12"></div>
            <div class="form-group"><label for="milestoneWalking">Walking (months)</label><input type="number" id="milestoneWalking" step="0.5" placeholder="Expected: 12-15"></div>
        </div>
        <h3 style="margin:15px 0 10px;font-size:1rem;color:var(--primary-color);">Language</h3>
        <div class="form-row">
            <div class="form-group"><label for="milestoneFirstWords">First Words (months)</label><input type="number" id="milestoneFirstWords" step="0.5" placeholder="Expected: 9-12"></div>
            <div class="form-group"><label for="milestoneSentences">2-3 Word Sentences (years)</label><input type="number" id="milestoneSentences" step="0.5" placeholder="Expected: 2"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="devRegression">Any Developmental Regression</label><select id="devRegression"><option value="">Select...</option><option value="no">No</option><option value="yes">Yes</option></select></div>
            <div class="form-group" id="devRegressionDetailsGroup" style="display:none;"><label for="devRegressionDetails">Details</label><input type="text" id="devRegressionDetails"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="schooling">Current Schooling</label><select id="schooling"><option value="">Select...</option><option value="not-school-age">Not School Age</option><option value="preschool">Preschool</option><option value="school">School</option></select></div>
            <div class="form-group"><label for="schoolPerformance">School Performance</label><select id="schoolPerformance"><option value="">Select...</option><option value="good">Good</option><option value="average">Average</option><option value="poor">Poor</option></select></div>
        </div>
    </div>
    <div class="card">
        <h2 class="card-title">Immunization History</h2>
        <div class="table-responsive">
            <table><thead><tr><th>Vaccine</th><th>Dose 1</th><th>Dose 2</th><th>Dose 3</th><th>Booster</th></tr></thead>
            <tbody>
                <tr><td>BCG</td><td><input type="date" id="bcg1"></td><td><input type="date" id="bcg2"></td><td><input type="date" id="bcg3"></td><td><input type="date" id="bcgBooster"></td></tr>
                <tr><td>Hepatitis B</td><td><input type="date" id="hepb1"></td><td><input type="date" id="hepb2"></td><td><input type="date" id="hepb3"></td><td><input type="date" id="hepbBooster"></td></tr>
                <tr><td>DPT/Pentavalent</td><td><input type="date" id="dpt1"></td><td><input type="date" id="dpt2"></td><td><input type="date" id="dpt3"></td><td><input type="date" id="dptBooster"></td></tr>
                <tr><td>OPV/IPV</td><td><input type="date" id="polio1"></td><td><input type="date" id="polio2"></td><td><input type="date" id="polio3"></td><td><input type="date" id="polioBooster"></td></tr>
                <tr><td>MMR/Measles</td><td><input type="date" id="mmr1"></td><td><input type="date" id="mmr2"></td><td>‚Äî</td><td>‚Äî</td></tr>
            </tbody></table>
        </div>
        <div class="form-group" style="margin-top:15px;"><label for="immunizationStatus">Overall Immunization Status</label><select id="immunizationStatus"><option value="">Select...</option><option value="up-to-date">Up to Date</option><option value="incomplete">Incomplete</option><option value="unknown">Unknown</option><option value="none">None</option></select></div>
    </div>
    <div class="card">
        <h2 class="card-title">Past Illnesses &amp; Hospitalizations</h2>
        <div class="table-responsive">
            <table id="pastIllnessTable"><thead><tr><th>Date/Age</th><th>Diagnosis</th><th>Treatment</th><th>Outcome</th><th></th></tr></thead>
            <tbody><tr><td><input type="text" placeholder="e.g., 2 years ago"></td><td><input type="text" placeholder="Diagnosis"></td><td><input type="text" placeholder="Treatment"></td><td><input type="text" placeholder="Outcome"></td><td><button class="remove-row-btn" onclick="removeRow(this)">√ó</button></td></tr></tbody></table>
        </div>
        <button class="add-row-btn" onclick="addIllnessRow()">+ Add Illness</button>
        <div class="form-group" style="margin-top:20px;"><label>Chronic Diseases</label>
            <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" name="chronic-disease" value="none"> None</label>
                <label class="checkbox-item"><input type="checkbox" name="chronic-disease" value="asthma"> Asthma</label>
                <label class="checkbox-item"><input type="checkbox" name="chronic-disease" value="epilepsy"> Epilepsy</label>
                <label class="checkbox-item"><input type="checkbox" name="chronic-disease" value="diabetes"> Diabetes</label>
                <label class="checkbox-item"><input type="checkbox" name="chronic-disease" value="heart"> Heart Disease</label>
                <label class="checkbox-item"><input type="checkbox" name="chronic-disease" value="sickle-cell"> Sickle Cell</label>
            </div>
        </div>
        <div class="form-group"><label for="knownAllergies">Known Allergies</label><input type="text" id="knownAllergies" placeholder="None or specify drug/food/environmental allergies"></div>
    </div>
    <div class="card">
        <h2 class="card-title">Current Medications</h2>
        <div class="table-responsive">
            <table id="currentMedsTable"><thead><tr><th>Medication</th><th>Dose</th><th>Route</th><th>Frequency</th><th>Indication</th><th></th></tr></thead>
            <tbody><tr>
                <td><input type="text" placeholder="Medication name"></td>
                <td><input type="text" placeholder="Dose"></td>
                <td><select><option value="">--</option><option value="PO">PO</option><option value="IV">IV</option><option value="IM">IM</option><option value="Inh">Inh</option></select></td>
                <td><input type="text" placeholder="Frequency"></td>
                <td><input type="text" placeholder="Indication"></td>
                <td><button class="remove-row-btn" onclick="removeRow(this)">√ó</button></td>
            </tr></tbody></table>
        </div>
        <button class="add-row-btn" onclick="addMedicationRow()">+ Add Medication</button>
    </div>
</div>

<!-- TAB 4: FAMILY & SOCIAL HISTORY -->
<div id="family-social" class="tab-content">
    <div class="card">
        <h2 class="card-title">Family History</h2>
        <h3 style="margin:15px 0 10px;color:var(--secondary-color);">Parents</h3>
        <div class="form-row">
            <div class="form-group"><label for="fatherAge">Father's Age</label><input type="number" id="fatherAge" min="0"></div>
            <div class="form-group"><label for="motherAge">Mother's Age</label><input type="number" id="motherAge" min="0"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="fatherOccupation">Father's Occupation</label><input type="text" id="fatherOccupation"></div>
            <div class="form-group"><label for="motherOccupation">Mother's Occupation</label><input type="text" id="motherOccupation"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="consanguinity">Consanguinity</label><select id="consanguinity"><option value="">Select...</option><option value="no">No</option><option value="yes">Yes</option></select></div>
            <div class="form-group" id="consanguinityDegreeGroup" style="display:none;"><label for="consanguinityDegree">Degree of Consanguinity</label><input type="text" id="consanguinityDegree"></div>
        </div>
        <h3 style="margin:20px 0 10px;color:var(--secondary-color);">Siblings</h3>
        <div class="table-responsive">
            <table id="siblingsTable"><thead><tr><th>No.</th><th>Age</th><th>Sex</th><th>Health Status</th><th>Relevant Conditions</th><th></th></tr></thead>
            <tbody><tr>
                <td>1</td>
                <td><input type="number" placeholder="Age"></td>
                <td><select><option value="">--</option><option value="M">M</option><option value="F">F</option></select></td>
                <td><input type="text" placeholder="Health status"></td>
                <td><input type="text" placeholder="Conditions"></td>
                <td><button class="remove-row-btn" onclick="removeRow(this)">√ó</button></td>
            </tr></tbody></table>
        </div>
        <button class="add-row-btn" onclick="addSiblingRow()">+ Add Sibling</button>
        <h3 style="margin:25px 0 10px;color:var(--secondary-color);">Family History Of</h3>
        <div class="form-row">
            <div class="form-group"><label>Asthma/Atopy/Allergies</label><select><option value="no">No</option><option value="yes">Yes</option></select></div>
            <div class="form-group"><label for="fhAsthma">If yes, details</label><input type="text" id="fhAsthma"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>Sickle Cell/Thalassemia</label><select><option value="no">No</option><option value="yes">Yes</option></select></div>
            <div class="form-group"><label for="fhHemoglobinopathy">If yes, details</label><input type="text" id="fhHemoglobinopathy"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>Genetic/Chromosomal Disorders</label><select><option value="no">No</option><option value="yes">Yes</option></select></div>
            <div class="form-group"><label for="fhGenetic">If yes, details</label><input type="text" id="fhGenetic"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>Diabetes Mellitus</label><select><option value="no">No</option><option value="yes">Yes</option></select></div>
            <div class="form-group"><label for="fhDiabetes">If yes, details</label><input type="text" id="fhDiabetes"></div>
        </div>
        <div class="form-group"><label for="fhOther">Other Significant Family History</label><textarea id="fhOther" rows="3" placeholder="TB, HIV, Cancer, Mental health disorders, etc."></textarea></div>
    </div>
    <div class="card">
        <h2 class="card-title">Social &amp; Environmental History</h2>
        <div class="form-row">
            <div class="form-group"><label for="ses">Socioeconomic Status</label><select id="ses"><option value="">Select...</option><option value="low">Low</option><option value="middle">Middle</option><option value="high">High</option></select></div>
            <div class="form-group"><label for="housingType">Housing Type</label><input type="text" id="housingType" placeholder="House, apartment, etc."></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="householdMembers">Number of Household Members</label><input type="number" id="householdMembers" min="1"></div>
            <div class="form-group"><label for="waterSource">Water Source</label><select id="waterSource"><option value="">Select...</option><option value="piped">Piped/Municipal</option><option value="well">Well</option><option value="river">River/Lake</option><option value="bottled">Bottled</option></select></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="sanitation">Sanitation</label><select id="sanitation"><option value="">Select...</option><option value="flush">Flush Toilet</option><option value="pit">Pit Latrine</option><option value="none">None</option></select></div>
            <div class="form-group"><label for="electricity">Electricity</label><select id="electricity"><option value="">Select...</option><option value="yes">Yes</option><option value="no">No</option></select></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="smokeExposure">Smoke Exposure</label><select id="smokeExposure"><option value="">Select...</option><option value="no">No</option><option value="yes">Yes</option></select></div>
            <div class="form-group"><label for="petsAnimals">Pets/Animal Exposure</label><input type="text" id="petsAnimals" placeholder="None or specify"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="tbContact">TB Contact</label><select id="tbContact"><option value="">Select...</option><option value="no">No</option><option value="yes">Yes</option><option value="unknown">Unknown</option></select></div>
            <div class="form-group"><label for="travelHistory">Recent Travel History</label><input type="text" id="travelHistory" placeholder="None or specify location and dates"></div>
        </div>
        <div class="form-group"><label for="sickContacts">Contact with Sick Individuals</label><textarea id="sickContacts" rows="2" placeholder="None or describe contacts"></textarea></div>
    </div>
</div>

<!-- TAB 5: DIFF DX HISTORY -->
<div id="diff-dx-history" class="tab-content">
    <div class="diff-dx-card">
        <h2 style="color:white;margin-bottom:10px;">‚≠ê DIFFERENTIAL DIAGNOSIS BASED ON HISTORY</h2>
        <p style="opacity:0.9;font-size:0.95rem;">Generate differential diagnoses BEFORE examining the patient</p>
    </div>
    <div class="card">
        <h2 class="card-title">Key Features from History</h2>
        <div class="alert alert-info">Summarize the most important features that will guide your differential diagnosis</div>
        <div class="form-group"><label>1. Most Important Feature</label><input type="text" id="keyFeature1" placeholder="e.g., 3-day history of high fever"></div>
        <div class="form-group"><label>2.</label><input type="text" id="keyFeature2" placeholder="e.g., Associated cough and difficulty breathing"></div>
        <div class="form-group"><label>3.</label><input type="text" id="keyFeature3"></div>
        <div class="form-group"><label>4.</label><input type="text" id="keyFeature4"></div>
        <div class="form-group"><label>5.</label><input type="text" id="keyFeature5"></div>
    </div>
    <div class="card">
        <h2 class="card-title">Provisional Differential Diagnoses (History-Based)</h2>
        <div class="diff-dx-item">
            <h4 style="margin-bottom:10px;color:var(--primary-color);">Differential #1 (Most Likely)</h4>
            <div class="form-group"><label>Diagnosis</label><input type="text" id="histDx1" placeholder="Your top differential based on history"></div>
            <div class="form-group"><label>Supporting Features from History</label><textarea id="histDx1Support" rows="2"></textarea></div>
            <div class="form-group"><label>Features Against</label><textarea id="histDx1Against" rows="2"></textarea></div>
        </div>
        <div class="diff-dx-item">
            <h4 style="margin-bottom:10px;color:var(--primary-color);">Differential #2</h4>
            <div class="form-group"><label>Diagnosis</label><input type="text" id="histDx2"></div>
            <div class="form-group"><label>Supporting Features from History</label><textarea id="histDx2Support" rows="2"></textarea></div>
            <div class="form-group"><label>Features Against</label><textarea id="histDx2Against" rows="2"></textarea></div>
        </div>
        <div class="diff-dx-item">
            <h4 style="margin-bottom:10px;color:var(--primary-color);">Differential #3</h4>
            <div class="form-group"><label>Diagnosis</label><input type="text" id="histDx3"></div>
            <div class="form-group"><label>Supporting Features from History</label><textarea id="histDx3Support" rows="2"></textarea></div>
            <div class="form-group"><label>Features Against</label><textarea id="histDx3Against" rows="2"></textarea></div>
        </div>
        <button class="btn btn-outline" style="width:100%;margin-top:10px;" onclick="addDifferential('history')">+ Add Another Differential</button>
    </div>
    <div class="card">
        <h2 class="card-title">What to Look for on Physical Examination</h2>
        <div class="alert alert-warning">For each differential above, list what findings would support or refute it</div>
        <div class="table-responsive">
            <table><thead><tr><th>Differential</th><th>Findings that would SUPPORT</th><th>Findings that would REFUTE</th></tr></thead>
            <tbody>
                <tr><td><span id="lookForDx1">Dx #1</span></td><td><textarea rows="2" id="lookForSupport1"></textarea></td><td><textarea rows="2" id="lookForRefute1"></textarea></td></tr>
                <tr><td><span id="lookForDx2">Dx #2</span></td><td><textarea rows="2" id="lookForSupport2"></textarea></td><td><textarea rows="2" id="lookForRefute2"></textarea></td></tr>
                <tr><td><span id="lookForDx3">Dx #3</span></td><td><textarea rows="2" id="lookForSupport3"></textarea></td><td><textarea rows="2" id="lookForRefute3"></textarea></td></tr>
            </tbody></table>
        </div>
    </div>
    <div class="card">
        <h2 class="card-title">Red Flags from History <span class="badge badge-danger">CRITICAL</span></h2>
        <div class="alert alert-danger">Serious diagnoses NOT to miss based on history</div>
        <div class="form-group"><label>1.</label><input type="text" id="redFlag1" placeholder="e.g., Meningitis"></div>
        <div class="form-group"><label>2.</label><input type="text" id="redFlag2" placeholder="e.g., Sepsis"></div>
        <div class="form-group"><label>3.</label><input type="text" id="redFlag3"></div>
    </div>
    <div class="card">
        <h2 class="card-title">Clinical Reasoning Notes</h2>
        <div class="form-group"><label>Your thinking process</label><textarea id="clinicalReasoningHistory" rows="6" placeholder="Explain your reasoning for ranking the differentials as you did...&#10;&#10;What patterns did you recognize?&#10;What key discriminating features did you identify?"></textarea></div>
    </div>
</div>

<!-- TAB 6: PHYSICAL EXAM -->
<div id="physical-exam" class="tab-content">
    <div class="card">
        <h2 class="card-title">General Appearance &amp; Vital Signs</h2>
        <div class="form-row">
            <div class="form-group"><label for="generalAppearance">General Appearance</label><select id="generalAppearance"><option value="">Select...</option><option value="well">Well</option><option value="ill-looking">Ill-looking</option><option value="toxic">Toxic</option><option value="lethargic">Lethargic</option><option value="alert-active">Alert &amp; Active</option></select></div>
            <div class="form-group"><label for="consciousness">Consciousness (AVPU)</label><select id="consciousness"><option value="">Select...</option><option value="alert">Alert</option><option value="verbal">Responsive to Verbal</option><option value="pain">Responsive to Pain</option><option value="unresponsive">Unresponsive</option></select></div>
        </div>
        <div class="form-row three-col">
            <div class="form-group"><label for="nutritionalStatus">Nutritional Status</label><select id="nutritionalStatus"><option value="">Select...</option><option value="well-nourished">Well-nourished</option><option value="mild-wasting">Mild wasting</option><option value="moderate-wasting">Moderate wasting</option><option value="severe-wasting">Severe wasting</option><option value="overweight">Overweight</option><option value="obese">Obese</option></select></div>
            <div class="form-group"><label for="hydrationStatus">Hydration Status</label><select id="hydrationStatus"><option value="">Select...</option><option value="well-hydrated">Well-hydrated</option><option value="some-dehydration">Some dehydration</option><option value="severe-dehydration">Severe dehydration</option></select></div>
            <div class="form-group"><label for="activity">Activity Level</label><select id="activity"><option value="">Select...</option><option value="active">Active</option><option value="quiet">Quiet</option><option value="irritable">Irritable</option><option value="lethargic">Lethargic</option></select></div>
        </div>
        <h3 style="margin:20px 0 10px;color:var(--secondary-color);">Vital Signs</h3>
        <div class="alert alert-info" style="font-size:0.85rem;">Coloured dots indicate: üü¢ Normal &nbsp; üü° Borderline &nbsp; üî¥ Abnormal (age-adjusted ranges)</div>
        <div class="form-row four-col">
            <div class="form-group"><label for="temperature">Temperature (¬∞C)</label><div style="display:flex;align-items:center;"><input type="number" id="temperature" step="0.1" min="30" max="45" onchange="interpretVitalSign('temperature')" style="flex:1;"><span id="tempInterpretation" class="vital-indicator" style="display:none;flex-shrink:0;"></span></div></div>
            <div class="form-group"><label for="heartRate">Heart Rate (bpm)</label><div style="display:flex;align-items:center;"><input type="number" id="heartRate" min="0" max="300" onchange="interpretVitalSign('hr')" style="flex:1;"><span id="hrInterpretation" class="vital-indicator" style="display:none;flex-shrink:0;"></span></div></div>
            <div class="form-group"><label for="respiratoryRate">Respiratory Rate (/min)</label><div style="display:flex;align-items:center;"><input type="number" id="respiratoryRate" min="0" max="100" onchange="interpretVitalSign('rr')" style="flex:1;"><span id="rrInterpretation" class="vital-indicator" style="display:none;flex-shrink:0;"></span></div></div>
            <div class="form-group"><label for="oxygenSaturation">SpO‚ÇÇ (%)</label><div style="display:flex;align-items:center;"><input type="number" id="oxygenSaturation" min="0" max="100" onchange="interpretVitalSign('spo2')" style="flex:1;"><span id="spo2Interpretation" class="vital-indicator" style="display:none;flex-shrink:0;"></span></div></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>Blood Pressure (mmHg)</label>
                <div style="display:flex;gap:10px;align-items:center;"><input type="number" id="bloodPressureSystolic" placeholder="Systolic" style="flex:1;"><span>/</span><input type="number" id="bloodPressureDiastolic" placeholder="Diastolic" style="flex:1;"></div></div>
            <div class="form-group"><label for="capillaryRefill">Capillary Refill Time (sec)</label><input type="number" id="capillaryRefill" step="0.5" min="0" max="10"></div>
        </div>
        <div class="form-group"><label>Oxygen Support</label>
            <div style="display:flex;gap:10px;">
                <select id="oxygenSupport" style="flex:1;"><option value="room-air">Room Air</option><option value="oxygen">Oxygen</option></select>
                <input type="number" id="oxygenFlow" placeholder="L/min" style="flex:1;display:none;">
            </div>
        </div>
    </div>
    <div class="card">
        <h2 class="card-title">Dehydration Assessment</h2>
        <div class="table-responsive">
            <table><thead><tr><th>Sign</th><th>Finding</th></tr></thead>
            <tbody>
                <tr><td>General Condition</td><td><select id="dehydGeneral"><option value="">Select...</option><option value="well">Well, alert</option><option value="restless">Restless, irritable</option><option value="lethargic">Lethargic/unconscious</option></select></td></tr>
                <tr><td>Eyes</td><td><select id="dehydEyes"><option value="">Select...</option><option value="normal">Normal</option><option value="sunken">Sunken</option><option value="very-sunken">Very sunken</option></select></td></tr>
                <tr><td>Tears</td><td><select id="dehydTears"><option value="">Select...</option><option value="present">Present</option><option value="absent">Absent</option></select></td></tr>
                <tr><td>Mouth/Tongue</td><td><select id="dehydMouth"><option value="">Select...</option><option value="moist">Moist</option><option value="dry">Dry</option><option value="very-dry">Very dry</option></select></td></tr>
                <tr><td>Thirst</td><td><select id="dehydThirst"><option value="">Select...</option><option value="normal">Drinks normally</option><option value="thirsty">Thirsty, drinks eagerly</option><option value="unable">Drinks poorly/unable</option></select></td></tr>
                <tr><td>Skin Pinch</td><td><select id="dehydSkin"><option value="">Select...</option><option value="quick">Goes back quickly</option><option value="slow">Goes back slowly (&lt;2s)</option><option value="very-slow">Goes back very slowly (&gt;2s)</option></select></td></tr>
            </tbody></table>
        </div>
        <div class="alert alert-warning" style="margin-top:15px;"><strong>Overall Classification: </strong><span id="dehydrationClassification">Select findings above to classify</span></div>
    </div>
    <div class="card">
        <h2 class="card-title">1. Skin, Hair, Nails</h2>
        <div class="form-group"><label>Skin Color</label>
            <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" name="skin-color" value="normal"> Normal</label>
                <label class="checkbox-item"><input type="checkbox" name="skin-color" value="pale"> Pale</label>
                <label class="checkbox-item"><input type="checkbox" name="skin-color" value="jaundiced"> Jaundiced</label>
                <label class="checkbox-item"><input type="checkbox" name="skin-color" value="cyanosed"> Cyanosed</label>
                <label class="checkbox-item"><input type="checkbox" name="skin-color" value="mottled"> Mottled</label>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="rashPresent">Rash Present</label><select id="rashPresent"><option value="no">No</option><option value="yes">Yes</option></select></div>
            <div class="form-group" id="rashDetailsGroup" style="display:none;"><label>Rash Type</label>
                <div class="checkbox-group">
                    <label class="checkbox-item"><input type="checkbox" value="macular"> Macular</label>
                    <label class="checkbox-item"><input type="checkbox" value="papular"> Papular</label>
                    <label class="checkbox-item"><input type="checkbox" value="vesicular"> Vesicular</label>
                    <label class="checkbox-item"><input type="checkbox" value="petechial"> Petechial</label>
                    <label class="checkbox-item"><input type="checkbox" value="purpuric"> Purpuric</label>
                </div>
            </div>
        </div>
        <div class="form-group"><label for="rashDescription">Rash Distribution &amp; Details</label><textarea id="rashDescription" rows="2" placeholder="Describe distribution, blanching, etc."></textarea></div>
        <div class="form-row">
            <div class="form-group"><label for="turgor">Skin Turgor</label><select id="turgor"><option value="">Select...</option><option value="normal">Normal</option><option value="reduced">Reduced</option></select></div>
            <div class="form-group"><label for="edema">Edema</label><select id="edema"><option value="no">No</option><option value="yes">Yes</option></select></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="hairExam">Hair</label><select id="hairExam"><option value="normal">Normal</option><option value="sparse">Sparse</option><option value="discolored">Discolored</option><option value="flag-sign">Flag sign</option></select></div>
            <div class="form-group"><label for="nailsExam">Nails</label><select id="nailsExam"><option value="normal">Normal</option><option value="clubbing">Clubbing</option><option value="koilonychia">Koilonychia</option><option value="other">Other</option></select></div>
        </div>
    </div>
    <div class="card">
        <h2 class="card-title">2. Head &amp; Fontanelles</h2>
        <div class="form-row">
            <div class="form-group"><label for="headShape">Head Shape</label><select id="headShape"><option value="">Select...</option><option value="normocephalic">Normocephalic</option><option value="microcephalic">Microcephalic</option><option value="macrocephalic">Macrocephalic</option></select></div>
            <div class="form-group"><label for="anteriorFontanelle">Anterior Fontanelle</label><select id="anteriorFontanelle"><option value="">Select...</option><option value="open-flat">Open &amp; Flat</option><option value="open-sunken">Open &amp; Sunken</option><option value="open-bulging">Open &amp; Bulging</option><option value="closed">Closed</option></select></div>
        </div>
    </div>
    <div class="card">
        <h2 class="card-title">3. Eyes</h2>
        <div class="form-row">
            <div class="form-group"><label for="conjunctivae">Conjunctivae</label><select id="conjunctivae"><option value="">Select...</option><option value="pink">Pink</option><option value="pale">Pale</option><option value="injected">Injected</option><option value="jaundiced">Jaundiced</option></select></div>
            <div class="form-group"><label for="pupils">Pupils</label><select id="pupils"><option value="">Select...</option><option value="equal-reactive">Equal &amp; Reactive</option><option value="unequal">Unequal</option><option value="non-reactive">Non-reactive</option></select></div>
        </div>
        <div class="form-group"><label for="redReflex">Red Reflex</label><select id="redReflex"><option value="">Select...</option><option value="present">Present bilaterally</option><option value="absent">Absent/abnormal</option></select></div>
    </div>
    <div class="card">
        <h2 class="card-title">4. Ears, Nose, Throat</h2>
        <div class="form-row">
            <div class="form-group"><label for="tympanicMembrane">Tympanic Membrane</label><select id="tympanicMembrane"><option value="">Select...</option><option value="normal">Normal</option><option value="bulging">Bulging</option><option value="retracted">Retracted</option><option value="perforated">Perforated</option><option value="erythematous">Erythematous</option></select></div>
            <div class="form-group"><label for="nasalDischarge">Nasal Discharge</label><select id="nasalDischarge"><option value="none">None</option><option value="clear">Clear</option><option value="purulent">Purulent</option><option value="bloody">Bloody</option></select></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="pharynx">Pharynx</label><select id="pharynx"><option value="">Select...</option><option value="normal">Normal</option><option value="erythematous">Erythematous</option><option value="exudate">Exudate</option></select></div>
            <div class="form-group"><label for="tonsils">Tonsils</label><select id="tonsils"><option value="">Select...</option><option value="normal">Normal</option><option value="enlarged-1">Grade 1/4</option><option value="enlarged-2">Grade 2/4</option><option value="enlarged-3">Grade 3/4</option><option value="enlarged-4">Grade 4/4</option></select></div>
        </div>
    </div>
    <div class="card">
        <h2 class="card-title">5. Neck</h2>
        <div class="form-row">
            <div class="form-group"><label for="lymphNodes">Lymph Nodes</label><select id="lymphNodes"><option value="">Select...</option><option value="not-palpable">Not Palpable</option><option value="palpable">Palpable</option></select></div>
            <div class="form-group"><label for="neckStiffness">Neck Stiffness</label><select id="neckStiffness"><option value="">Select...</option><option value="no">No</option><option value="yes">Yes</option></select></div>
        </div>
        <div class="form-group"><label for="lymphNodeDetails">Lymph Node Details</label><input type="text" id="lymphNodeDetails" placeholder="Location, size, consistency, tenderness, mobility"></div>
    </div>
    <div class="card">
        <h2 class="card-title">6. Chest &amp; Respiratory System</h2>
        <div class="form-group"><label for="chestShape">Chest Shape</label><select id="chestShape"><option value="">Select...</option><option value="normal">Normal</option><option value="barrel">Barrel chest</option><option value="pectus-excavatum">Pectus excavatum</option><option value="pectus-carinatum">Pectus carinatum</option></select></div>
        <div class="form-group"><label>Respiratory Effort</label>
            <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" name="resp-effort" value="normal"> Normal</label>
                <label class="checkbox-item"><input type="checkbox" name="resp-effort" value="intercostal"> Intercostal retractions</label>
                <label class="checkbox-item"><input type="checkbox" name="resp-effort" value="subcostal"> Subcostal retractions</label>
                <label class="checkbox-item"><input type="checkbox" name="resp-effort" value="suprasternal"> Suprasternal retractions</label>
                <label class="checkbox-item"><input type="checkbox" name="resp-effort" value="nasal-flaring"> Nasal flaring</label>
                <label class="checkbox-item"><input type="checkbox" name="resp-effort" value="grunting"> Grunting</label>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="airEntry">Air Entry</label><select id="airEntry"><option value="">Select...</option><option value="equal">Equal bilateral</option><option value="reduced-right">Reduced on right</option><option value="reduced-left">Reduced on left</option></select></div>
            <div class="form-group"><label for="breathSounds">Breath Sounds</label><select id="breathSounds"><option value="">Select...</option><option value="vesicular">Vesicular</option><option value="bronchial">Bronchial</option><option value="reduced">Reduced</option><option value="absent">Absent</option></select></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="crackles">Crackles/Crepitations</label><select id="crackles"><option value="no">No</option><option value="fine">Yes - Fine</option><option value="coarse">Yes - Coarse</option></select></div>
            <div class="form-group"><label for="wheezing">Wheezing</label><select id="wheezing"><option value="no">No</option><option value="expiratory">Yes - Expiratory</option><option value="inspiratory">Yes - Inspiratory</option><option value="both">Yes - Both</option></select></div>
        </div>
        <div class="form-group"><label for="stridor">Stridor</label><select id="stridor"><option value="no">No</option><option value="yes">Yes</option></select></div>
    </div>
    <div class="card">
        <h2 class="card-title">7. Cardiovascular System</h2>
        <div class="form-row">
            <div class="form-group"><label for="cyanosisType">Cyanosis</label><select id="cyanosisType"><option value="no">No</option><option value="central">Central</option><option value="peripheral">Peripheral</option><option value="differential">Differential</option></select></div>
            <div class="form-group"><label for="clubbing">Clubbing</label><select id="clubbing"><option value="no">No</option><option value="yes">Yes</option></select></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="apexBeat">Apex Beat</label><input type="text" id="apexBeat" placeholder="Location &amp; character"></div>
            <div class="form-group"><label for="heartSounds">Heart Sounds</label><select id="heartSounds"><option value="">Select...</option><option value="normal">Normal S1 &amp; S2</option><option value="s3">S3 present</option><option value="split-s2">Split S2</option><option value="loud-p2">Loud P2</option></select></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="murmur">Murmur</label><select id="murmur"><option value="no">No</option><option value="yes">Yes</option></select></div>
            <div class="form-group"><label for="femoralPulses">Femoral Pulses</label><select id="femoralPulses"><option value="">Select...</option><option value="present">Present bilaterally</option><option value="weak">Weak</option><option value="absent">Absent</option></select></div>
        </div>
        <div id="murmurDetails" style="display:none;">
            <h4 style="margin:15px 0 10px;color:var(--secondary-color);">Murmur Characteristics</h4>
            <div class="form-row">
                <div class="form-group"><label for="murmurTiming">Timing</label><select id="murmurTiming"><option value="">Select...</option><option value="systolic">Systolic</option><option value="diastolic">Diastolic</option><option value="continuous">Continuous</option></select></div>
                <div class="form-group"><label for="murmurGrade">Grade</label><select id="murmurGrade"><option value="">Select...</option><option value="1/6">1/6</option><option value="2/6">2/6</option><option value="3/6">3/6</option><option value="4/6">4/6</option><option value="5/6">5/6</option><option value="6/6">6/6</option></select></div>
            </div>
            <div class="form-group"><label for="murmurLocation">Location &amp; Radiation</label><input type="text" id="murmurLocation" placeholder="e.g., Apex, radiates to axilla"></div>
        </div>
    </div>
    <div class="card">
        <h2 class="card-title">8. Abdomen</h2>
        <div class="form-row">
            <div class="form-group"><label for="abdShape">Abdominal Shape</label><select id="abdShape"><option value="">Select...</option><option value="flat">Flat</option><option value="distended">Distended</option><option value="scaphoid">Scaphoid</option><option value="protuberant">Protuberant</option></select></div>
            <div class="form-group"><label for="bowelSounds">Bowel Sounds</label><select id="bowelSounds"><option value="">Select...</option><option value="normal">Normal</option><option value="hyperactive">Hyperactive</option><option value="hypoactive">Hypoactive</option><option value="absent">Absent</option></select></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="abdTenderness">Tenderness</label><select id="abdTenderness"><option value="no">No</option><option value="yes">Yes</option></select></div>
            <div class="form-group" id="tendernessLocationGroup" style="display:none;"><label>Location</label>
                <div class="checkbox-group">
                    <label class="checkbox-item"><input type="checkbox" value="ruq"> RUQ</label>
                    <label class="checkbox-item"><input type="checkbox" value="luq"> LUQ</label>
                    <label class="checkbox-item"><input type="checkbox" value="rlq"> RLQ</label>
                    <label class="checkbox-item"><input type="checkbox" value="llq"> LLQ</label>
                    <label class="checkbox-item"><input type="checkbox" value="periumbilical"> Periumbilical</label>
                </div>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="liver">Liver</label><select id="liver"><option value="">Select...</option><option value="not-palpable">Not Palpable</option><option value="palpable">Palpable</option></select></div>
            <div class="form-group"><label for="liverSize">If palpable (cm below costal margin)</label><input type="number" id="liverSize" step="0.5" min="0"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="spleen">Spleen</label><select id="spleen"><option value="">Select...</option><option value="not-palpable">Not Palpable</option><option value="palpable">Palpable</option></select></div>
            <div class="form-group"><label for="spleenSize">If palpable (cm below costal margin)</label><input type="number" id="spleenSize" step="0.5" min="0"></div>
        </div>
        <div class="form-group"><label for="abdAdditional">Additional Abdominal Findings</label><textarea id="abdAdditional" rows="2" placeholder="Ascites, hernias, masses, etc."></textarea></div>
    </div>
    <div class="card">
        <h2 class="card-title">9. Genitourinary &amp; 10. Musculoskeletal / Neurological</h2>
        <div class="form-group"><label for="guExam">Genitourinary Examination</label><textarea id="guExam" rows="3" placeholder="Males: Penis, testes, hydrocele&#10;Females: External genitalia&#10;Tanner staging if applicable"></textarea></div>
        <div class="form-row">
            <div class="form-group"><label for="muscleTone">Muscle Tone</label><select id="muscleTone"><option value="">Select...</option><option value="normal">Normal</option><option value="hypotonic">Hypotonic</option><option value="hypertonic">Hypertonic</option></select></div>
            <div class="form-group"><label for="gait">Gait</label><select id="gait"><option value="">Select...</option><option value="normal">Normal</option><option value="antalgic">Antalgic</option><option value="ataxic">Ataxic</option><option value="not-walking">Not walking yet</option></select></div>
        </div>
        <div class="form-group"><label>Meningeal Signs</label>
            <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" name="meningeal" value="neck-stiffness"> Neck Stiffness</label>
                <label class="checkbox-item"><input type="checkbox" name="meningeal" value="kernig"> Kernig Sign</label>
                <label class="checkbox-item"><input type="checkbox" name="meningeal" value="brudzinski"> Brudzinski Sign</label>
            </div>
        </div>
        <div class="form-group"><label for="neuroAdditional">Additional Neurological/MSK Findings</label><textarea id="neuroAdditional" rows="3" placeholder="Power, reflexes, primitive reflexes, cerebellar signs, joint examination, etc."></textarea></div>
        <div class="form-group"><label for="peAdditionalFindings">Other Significant Findings</label><textarea id="peAdditionalFindings" rows="3" placeholder="Any other important findings not captured above..."></textarea></div>
    </div>
</div>

<!-- TAB 7: DIFF DX FINAL -->
<div id="diff-dx-final" class="tab-content">
    <div class="diff-dx-card">
        <h2 style="color:white;margin-bottom:10px;">‚≠ê FINAL DIFFERENTIAL DIAGNOSIS</h2>
        <p style="opacity:0.9;font-size:0.95rem;">Updated after physical examination ‚Äî compare with history-based differentials</p>
    </div>

    <!-- Summary Panel auto-populated from history tab -->
    <div class="summary-panel" id="summaryPanel">
        <h3 style="color:white;margin-bottom:12px;">üìã Key Features Summary (from History)</h3>
        <div class="summary-item"><strong>Feature 1:</strong> <span id="summaryHistKey1">--</span></div>
        <div class="summary-item"><strong>Feature 2:</strong> <span id="summaryHistKey2">--</span></div>
        <div class="summary-item"><strong>Feature 3:</strong> <span id="summaryHistKey3">--</span></div>
        <div class="summary-item" style="margin-top:10px;font-style:italic;opacity:0.85;font-size:0.85rem;">Values auto-populate from the Diff Dx (History) tab</div>
    </div>

    <div class="card">
        <h2 class="card-title">Comparison Table</h2>
        <div class="table-responsive">
            <table>
                <thead><tr><th>Feature</th><th id="compareDx1">Dx #1</th><th id="compareDx2">Dx #2</th><th id="compareDx3">Dx #3</th></tr></thead>
                <tbody>
                    <tr><td>History supports</td><td><select><option value="">--</option><option value="strongly">Strongly</option><option value="partially">Partially</option><option value="against">Against</option></select></td><td><select><option value="">--</option><option value="strongly">Strongly</option><option value="partially">Partially</option><option value="against">Against</option></select></td><td><select><option value="">--</option><option value="strongly">Strongly</option><option value="partially">Partially</option><option value="against">Against</option></select></td></tr>
                    <tr><td>Exam supports</td><td><select><option value="">--</option><option value="strongly">Strongly</option><option value="partially">Partially</option><option value="against">Against</option></select></td><td><select><option value="">--</option><option value="strongly">Strongly</option><option value="partially">Partially</option><option value="against">Against</option></select></td><td><select><option value="">--</option><option value="strongly">Strongly</option><option value="partially">Partially</option><option value="against">Against</option></select></td></tr>
                    <tr><td>Fit with age</td><td><select><option value="">--</option><option value="typical">Typical</option><option value="possible">Possible</option><option value="unusual">Unusual</option></select></td><td><select><option value="">--</option><option value="typical">Typical</option><option value="possible">Possible</option><option value="unusual">Unusual</option></select></td><td><select><option value="">--</option><option value="typical">Typical</option><option value="possible">Possible</option><option value="unusual">Unusual</option></select></td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="card">
        <h2 class="card-title">Final Differential Diagnoses (After Exam)</h2>
        <div class="diff-dx-item">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;"><h4 style="color:var(--primary-color);">Final Differential #1 (Most Likely) <span class="badge badge-primary">Primary</span></h4></div>
            <div class="form-group"><label>Diagnosis</label><input type="text" id="finalDx1" placeholder="Your most likely final diagnosis"></div>
            <div class="form-row">
                <div class="form-group"><label>Supporting Features (History)</label><textarea id="finalDx1HistSupport" rows="2"></textarea></div>
                <div class="form-group"><label>Supporting Features (Exam)</label><textarea id="finalDx1ExamSupport" rows="2"></textarea></div>
            </div>
            <div class="form-group"><label>Features Against</label><textarea id="finalDx1Against" rows="2"></textarea></div>
        </div>
        <div class="diff-dx-item">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;"><h4 style="color:var(--primary-color);">Final Differential #2</h4></div>
            <div class="form-group"><label>Diagnosis</label><input type="text" id="finalDx2"></div>
            <div class="form-row">
                <div class="form-group"><label>Supporting Features (History)</label><textarea id="finalDx2HistSupport" rows="2"></textarea></div>
                <div class="form-group"><label>Supporting Features (Exam)</label><textarea id="finalDx2ExamSupport" rows="2"></textarea></div>
            </div>
            <div class="form-group"><label>Features Against</label><textarea id="finalDx2Against" rows="2"></textarea></div>
        </div>
        <div class="diff-dx-item">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;"><h4 style="color:var(--primary-color);">Final Differential #3</h4></div>
            <div class="form-group"><label>Diagnosis</label><input type="text" id="finalDx3"></div>
            <div class="form-row">
                <div class="form-group"><label>Supporting Features (History)</label><textarea id="finalDx3HistSupport" rows="2"></textarea></div>
                <div class="form-group"><label>Supporting Features (Exam)</label><textarea id="finalDx3ExamSupport" rows="2"></textarea></div>
            </div>
            <div class="form-group"><label>Features Against</label><textarea id="finalDx3Against" rows="2"></textarea></div>
        </div>
        <button class="btn btn-outline" style="width:100%;margin-top:10px;" onclick="addDifferential('final')">+ Add Another Differential</button>
    </div>
    <div class="card">
        <h2 class="card-title">Working Diagnosis</h2>
        <div class="form-group"><label for="workingDiagnosis" class="required">Working Diagnosis</label><input type="text" id="workingDiagnosis" placeholder="Your primary working diagnosis"></div>
        <div class="form-group"><label for="diagnosisBasis">Basis for Diagnosis</label><textarea id="diagnosisBasis" rows="4" placeholder="Briefly justify this diagnosis..."></textarea></div>
        <div class="form-group"><label for="clinicalReasoningFinal">Clinical Reasoning</label><textarea id="clinicalReasoningFinal" rows="5" placeholder="How has your thinking changed after the physical exam?&#10;What were the most important discriminating features?"></textarea></div>
    </div>
</div>

<!-- TAB 8: INVESTIGATIONS -->
<div id="investigations" class="tab-content">
    <div class="card">
        <h2 class="card-title">Investigation Plan</h2>
        <div class="alert alert-info">List investigations ordered, justified by your differential diagnoses</div>
        <div class="table-responsive">
            <table id="investigationPlanTable">
                <thead><tr><th>Investigation</th><th>Justification</th><th>Priority</th><th>Status</th><th></th></tr></thead>
                <tbody><tr>
                    <td><input type="text" placeholder="e.g., FBC, CXR"></td>
                    <td><input type="text" placeholder="Why ordered"></td>
                    <td><select><option value="urgent">Urgent</option><option value="routine">Routine</option></select></td>
                    <td><select><option value="ordered">Ordered</option><option value="pending">Pending</option><option value="resulted">Resulted</option></select></td>
                    <td><button class="remove-row-btn" onclick="removeRow(this)">√ó</button></td>
                </tr></tbody>
            </table>
        </div>
        <button class="add-row-btn" onclick="addInvestigationPlanRow()">+ Add Investigation</button>
    </div>

    <div class="card">
        <h2 class="card-title">CBC / Full Blood Count</h2>
        <div class="form-row four-col">
            <div class="form-group"><label>WBC (√ó10‚Åπ/L)</label><div style="display:flex;align-items:center;gap:5px;"><input type="number" id="wbc" step="0.1"><span id="wbcInterpretation" style="font-size:0.75rem;white-space:nowrap;">--</span></div></div>
            <div class="form-group"><label>Hgb (g/dL)</label><div style="display:flex;align-items:center;gap:5px;"><input type="number" id="hgb" step="0.1"><span id="hgbInterpretation" style="font-size:0.75rem;white-space:nowrap;">--</span></div></div>
            <div class="form-group"><label>Platelets (√ó10‚Åπ/L)</label><div style="display:flex;align-items:center;gap:5px;"><input type="number" id="platelets"><span id="plateletsInterpretation" style="font-size:0.75rem;white-space:nowrap;">--</span></div></div>
            <div class="form-group"><label>HCT / PCV (%)</label><input type="number" id="hematocrit" step="0.1"></div>
        </div>
        <div class="form-row four-col">
            <div class="form-group"><label>Neutrophils (%)</label><div style="display:flex;align-items:center;gap:5px;"><input type="number" id="neutrophils" step="0.1"><span id="neutrophilsInterpretation" style="font-size:0.75rem;white-space:nowrap;">--</span></div></div>
            <div class="form-group"><label>Lymphocytes (%)</label><div style="display:flex;align-items:center;gap:5px;"><input type="number" id="lymphocytes" step="0.1"><span id="lymphocytesInterpretation" style="font-size:0.75rem;white-space:nowrap;">--</span></div></div>
            <div class="form-group"><label>Eosinophils (%)</label><input type="number" id="eosinophils" step="0.1"></div>
            <div class="form-group"><label>MCV (fL)</label><input type="number" id="mcv" step="0.1"></div>
        </div>
        <div class="form-group"><label>Film Comment</label><textarea id="bloodFilmComment" rows="2"></textarea></div>
    </div>

    <div class="card">
        <h2 class="card-title">Metabolic Panel</h2>
        <div class="form-row four-col">
            <div class="form-group"><label>Glucose (mg/dL)</label><div style="display:flex;align-items:center;gap:5px;"><input type="number" id="glucose" step="0.1"><span id="glucoseInterpretation" style="font-size:0.75rem;white-space:nowrap;">--</span></div></div>
            <div class="form-group"><label>Na‚Å∫ (mEq/L)</label><div style="display:flex;align-items:center;gap:5px;"><input type="number" id="sodium" step="0.1"><span id="sodiumInterpretation" style="font-size:0.75rem;white-space:nowrap;">--</span></div></div>
            <div class="form-group"><label>K‚Å∫ (mEq/L)</label><div style="display:flex;align-items:center;gap:5px;"><input type="number" id="potassium" step="0.1"><span id="potassiumInterpretation" style="font-size:0.75rem;white-space:nowrap;">--</span></div></div>
            <div class="form-group"><label>Cl‚Åª (mEq/L)</label><input type="number" id="chloride" step="0.1"></div>
        </div>
        <div class="form-row four-col">
            <div class="form-group"><label>Urea (mg/dL)</label><input type="number" id="urea" step="0.1"></div>
            <div class="form-group"><label>Creatinine (mg/dL)</label><div style="display:flex;align-items:center;gap:5px;"><input type="number" id="creatinine" step="0.01"><span id="creatinineInterpretation" style="font-size:0.75rem;white-space:nowrap;">--</span></div></div>
            <div class="form-group"><label>Total Bilirubin (mg/dL)</label><input type="number" id="totalBilirubin" step="0.1"></div>
            <div class="form-group"><label>CRP (mg/L)</label><input type="number" id="crp" step="0.1"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label>ALT (U/L)</label><input type="number" id="alt"></div>
            <div class="form-group"><label>AST (U/L)</label><input type="number" id="ast"></div>
        </div>
    </div>

    <div class="card">
        <h2 class="card-title">Imaging &amp; Other Results</h2>
        <div class="form-row">
            <div class="form-group"><label for="chestXray">Chest X-Ray</label><select id="chestXray"><option value="not-done">Not done</option><option value="done">Done</option></select></div>
            <div class="form-group" id="chestXrayFindingsGroup" style="display:none;"><label for="chestXrayFindings">Findings</label><textarea id="chestXrayFindings" rows="3" placeholder="Describe CXR findings..."></textarea></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="ultrasound">Ultrasound</label><select id="ultrasound"><option value="not-done">Not done</option><option value="done">Done</option></select></div>
            <div class="form-group" id="ultrasoundFindingsGroup" style="display:none;"><label for="ultrasoundFindings">Findings</label><textarea id="ultrasoundFindings" rows="3"></textarea></div>
        </div>
        <div class="form-group"><label for="urineMicroscopy">Urine Microscopy &amp; C/S</label><textarea id="urineMicroscopy" rows="3" placeholder="WBC, RBC, casts, organisms..."></textarea></div>
        <div class="form-group"><label for="bloodCulture">Blood Culture</label><textarea id="bloodCulture" rows="2" placeholder="Organism, sensitivities..."></textarea></div>
        <div class="form-group"><label for="otherInvestigations">Other Results</label><textarea id="otherInvestigations" rows="4" placeholder="Malaria RDT, Mantoux, ECG, Echo, etc."></textarea></div>
    </div>

    <div class="card">
        <h2 class="card-title">Interpretation &amp; Diagnosis Impact</h2>
        <div class="form-group"><label for="investigationSummary">Summary of Key Investigation Findings</label><textarea id="investigationSummary" rows="4" placeholder="What do the results show overall?"></textarea></div>
        <div class="form-group"><label for="diagnosisImpact">How Results Change/Confirm Diagnosis</label><textarea id="diagnosisImpact" rows="4" placeholder="Do results support your working diagnosis? Any surprises?"></textarea></div>
    </div>
</div>

<!-- TAB 9: MANAGEMENT -->
<div id="management" class="tab-content">
    <div class="card">
        <h2 class="card-title">Admission Decision &amp; Triage</h2>
        <div class="form-row">
            <div class="form-group"><label for="admissionDecision">Admission Decision</label><select id="admissionDecision"><option value="">Select...</option><option value="admit">Admit</option><option value="discharge">Discharge</option><option value="observation">Observation</option></select></div>
            <div class="form-group" id="wardGroup" style="display:none;"><label for="ward">Ward / Unit</label><input type="text" id="ward" placeholder="e.g., General Pediatrics, PICU"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="admissionDate2">Admission Date</label><input type="date" id="admissionDate2"></div>
            <div class="form-group"><label for="dischargeDate">Discharge Date</label><input type="date" id="dischargeDate"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="totalDaysAdmitted">Total Days Admitted</label><input type="number" id="totalDaysAdmitted" readonly placeholder="Auto-calculated"></div>
        </div>
    </div>

    <div class="card">
        <h2 class="card-title">Fluid Management</h2>
        <div class="alert alert-info">
            <strong>Holliday-Segar Maintenance Fluids:</strong>
            Patient Weight: <strong><span id="maintenanceWeight">--</span> kg</strong> ‚Üí
            Daily: <strong><span id="maintenanceFluid">--</span> mL/day</strong> ‚Üí
            Rate: <strong><span id="maintenanceFluidRate">--</span> mL/hr</strong>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="fluidType">Fluid Type</label><select id="fluidType"><option value="">Select...</option><option value="normal-saline">Normal Saline (0.9%)</option><option value="half-saline">Half Saline (0.45%)</option><option value="d5-ns">D5 Normal Saline</option><option value="d5-halfns">D5 Half Saline</option><option value="rl">Ringer's Lactate</option><option value="oral">Oral Rehydration</option></select></div>
            <div class="form-group"><label for="fluidRate">Prescribed Rate (mL/hr)</label><input type="number" id="fluidRate" step="0.1"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="fluidIndication">Indication</label><select id="fluidIndication"><option value="">Select...</option><option value="maintenance">Maintenance</option><option value="deficit">Deficit Replacement</option><option value="resuscitation">Resuscitation</option></select></div>
            <div class="form-group"><label for="fluidRoute">Route</label><select id="fluidRoute"><option value="iv">IV</option><option value="oral">Oral</option><option value="ng">NG Tube</option></select></div>
        </div>
        <div class="form-group"><label for="fluidNotes">Fluid Plan Notes</label><textarea id="fluidNotes" rows="3" placeholder="e.g., Give over 24 hours, reassess at 8 hours..."></textarea></div>
    </div>

    <div class="card">
        <h2 class="card-title">Medications</h2>
        <div class="alert alert-info">
            Patient Weight for Dosing: <strong><span id="doseCalcWeight">--</span> kg</strong>
            &nbsp;|&nbsp; Dose (mg/kg): <input type="number" id="doseCalcMgKg" step="0.1" style="width:80px;display:inline-block;padding:4px 8px;">
            &nbsp;= <strong><span id="doseCalcTotal">--</span> mg</strong>
        </div>
        <div class="table-responsive">
            <table id="medicationsTable">
                <thead><tr><th>Drug</th><th>Dose (mg/kg or flat)</th><th>Calculated Dose</th><th>Route</th><th>Frequency</th><th>Duration</th><th></th></tr></thead>
                <tbody><tr>
                    <td><input type="text" placeholder="Drug name"></td>
                    <td><input type="text" placeholder="e.g., 50 mg/kg"></td>
                    <td><input type="text" placeholder="Total dose"></td>
                    <td><select><option>IV</option><option>PO</option><option>IM</option><option>Inh</option><option>Top</option><option>PR</option></select></td>
                    <td><input type="text" placeholder="e.g., Q8h"></td>
                    <td><input type="text" placeholder="e.g., 7 days"></td>
                    <td><button class="remove-row-btn" onclick="removeRow(this)">√ó</button></td>
                </tr></tbody>
            </table>
        </div>
        <button class="add-row-btn" onclick="addMedicationManagementRow()">+ Add Medication</button>
    </div>

    <div class="card">
        <h2 class="card-title">Nutritional Management</h2>
        <div class="form-row">
            <div class="form-group"><label for="dietOrder">Diet Order</label><select id="dietOrder"><option value="">Select...</option><option value="npo">NPO</option><option value="clear-liquids">Clear Liquids</option><option value="soft">Soft Diet</option><option value="regular">Regular Diet</option><option value="breastfeeding">Continue Breastfeeding</option><option value="therapeutic">Therapeutic (RUTF)</option></select></div>
            <div class="form-group"><label for="feedingRoute">Route</label><select id="feedingRoute"><option value="oral">Oral</option><option value="ng">Nasogastric</option><option value="tpn">TPN</option></select></div>
        </div>
        <div class="form-group"><label for="nutritionNotes">Nutritional Notes</label><textarea id="nutritionNotes" rows="3" placeholder="Caloric target, feeding schedule, special considerations..."></textarea></div>
    </div>

    <div class="card">
        <h2 class="card-title">Monitoring &amp; Nursing Orders</h2>
        <div class="form-group"><label>Monitoring Frequency</label>
            <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" name="monitoring" value="vitals-q4h"> Vitals Q4h</label>
                <label class="checkbox-item"><input type="checkbox" name="monitoring" value="vitals-q8h"> Vitals Q8h</label>
                <label class="checkbox-item"><input type="checkbox" name="monitoring" value="urine-output"> Urine output</label>
                <label class="checkbox-item"><input type="checkbox" name="monitoring" value="daily-weight"> Daily weight</label>
                <label class="checkbox-item"><input type="checkbox" name="monitoring" value="blood-glucose"> Blood glucose</label>
                <label class="checkbox-item"><input type="checkbox" name="monitoring" value="spo2"> Continuous SpO‚ÇÇ</label>
            </div>
        </div>
        <div class="form-group"><label for="nursingOrders">Additional Nursing Orders</label><textarea id="nursingOrders" rows="3" placeholder="Positioning, suction, wound care, isolation precautions, etc."></textarea></div>
    </div>

    <div class="card">
        <h2 class="card-title">Problem-Based Plan</h2>
        <div class="form-group"><label>Problem 1 &amp; Plan</label><input type="text" id="problem1" placeholder="Problem"><textarea id="plan1" rows="3" style="margin-top:5px;" placeholder="Plan for problem 1..."></textarea></div>
        <div class="form-group"><label>Problem 2 &amp; Plan</label><input type="text" id="problem2" placeholder="Problem"><textarea id="plan2" rows="3" style="margin-top:5px;"></textarea></div>
        <div class="form-group"><label>Problem 3 &amp; Plan</label><input type="text" id="problem3" placeholder="Problem"><textarea id="plan3" rows="3" style="margin-top:5px;"></textarea></div>
        <div class="form-group"><label for="consultations">Consultations Requested</label><textarea id="consultations" rows="2" placeholder="e.g., Cardiology, Neurology, Social Work..."></textarea></div>
        <div class="form-group"><label for="parentCounseling">Parent/Caregiver Counseling</label><textarea id="parentCounseling" rows="3" placeholder="Key points discussed with caregiver..."></textarea></div>
    </div>

    <div class="card">
        <h2 class="card-title">Discharge Planning</h2>
        <div class="form-group"><label for="dischargeDiagnosis">Discharge Diagnosis</label><input type="text" id="dischargeDiagnosis" placeholder="Final diagnosis at discharge"></div>
        <div class="form-group"><label for="dischargeCondition">Condition at Discharge</label><select id="dischargeCondition"><option value="">Select...</option><option value="recovered">Recovered</option><option value="improved">Improved</option><option value="unchanged">Unchanged</option><option value="worse">Worse</option><option value="deceased">Deceased</option><option value="lama">LAMA</option></select></div>
        <div class="form-group"><label for="dischargeMeds">Discharge Medications</label><textarea id="dischargeMeds" rows="4" placeholder="List each medication with dose, frequency, and duration..."></textarea></div>
        <div class="form-group"><label for="followUpPlan">Follow-up Plan</label><textarea id="followUpPlan" rows="3" placeholder="Clinic, date, who to see, red flags to return for..."></textarea></div>
        <div class="form-group"><label for="parentInstructions">Instructions to Caregiver</label><textarea id="parentInstructions" rows="4" placeholder="Return to hospital if... &#10;Give medications as follows...&#10;Follow up at..."></textarea></div>
    </div>
</div>

<!-- TAB 10: PROGRESS NOTES -->
<div id="progress" class="tab-content">
    <div class="card">
        <h2 class="card-title">Progress Notes</h2>
        <div class="alert alert-info">Use SOAP format. Each note documents one clinical encounter.</div>
        <button class="btn btn-primary" onclick="addProgressNote()" style="width:100%;margin-bottom:20px;">+ Add Progress Note</button>
    </div>
    <div id="progressNotesContainer"></div>
</div>

<!-- TAB 11: NEONATAL -->
<div id="neonatal" class="tab-content">
    <div class="card" style="background:linear-gradient(135deg,#a8edea,#fed6e3);border:none;">
        <h2 style="color:#2c3e50;margin-bottom:5px;">üë∂ Neonatal Assessment</h2>
        <p style="color:#555;font-size:0.9rem;">Complete this section for infants &lt;28 days of age</p>
    </div>

    <div class="card">
        <h2 class="card-title">Neonatal Identification</h2>
        <div class="form-row">
            <div class="form-group"><label for="neo-patient-name">Baby's Name / ID</label><input type="text" id="neo-patient-name" placeholder="Baby of [Mother's Name] or name"></div>
            <div class="form-group"><label for="neo-mother-name">Mother's Name</label><input type="text" id="neo-mother-name"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="neo-dob">Date of Birth</label><input type="date" id="neo-dob" onchange="calculateNeoAge()"></div>
            <div class="form-group"><label for="neo-tob">Time of Birth</label><input type="time" id="neo-tob" onchange="calculateNeoAge()"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="neo-doa">Date of Admission</label><input type="date" id="neo-doa" onchange="calculateNeoAge()"></div>
            <div class="form-group"><label for="neo-toa">Time of Admission</label><input type="time" id="neo-toa" onchange="calculateNeoAge()"></div>
        </div>
        <div class="form-group"><label for="neo-age-admission">Age at Admission</label><input type="text" id="neo-age-admission" readonly placeholder="Auto-calculated"></div>
    </div>

    <div class="card">
        <h2 class="card-title">Maternal &amp; Obstetric History</h2>
        <div class="form-row">
            <div class="form-group"><label for="neo-gravida">Gravida</label><input type="number" id="neo-gravida" min="0"></div>
            <div class="form-group"><label for="neo-para">Para</label><input type="number" id="neo-para" min="0"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="neo-anc">Antenatal Care</label><select id="neo-anc"><option value="">Select...</option><option value="adequate">Adequate</option><option value="inadequate">Inadequate</option><option value="none">None</option></select></div>
            <div class="form-group"><label for="neo-anc-visits">ANC Visits</label><input type="number" id="neo-anc-visits" min="0"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="neo-maternal-blood-group">Maternal Blood Group</label><select id="neo-maternal-blood-group"><option value="">--</option><option>A+</option><option>A-</option><option>B+</option><option>B-</option><option>AB+</option><option>AB-</option><option>O+</option><option>O-</option></select></div>
            <div class="form-group"><label for="neo-prom">PROM (&gt;18h before delivery)</label><select id="neo-prom" onchange="togglePromDuration()"><option value="no">No</option><option value="yes">Yes</option></select></div>
        </div>
        <div class="form-row" id="neo-prom-details" style="display:none;">
            <div class="form-group"><label for="neo-prom-duration">Duration of PROM</label><input type="text" id="neo-prom-duration" placeholder="e.g., 24 hours"></div>
            <div class="form-group"><label for="neo-prom-foul-liquor">Foul-smelling Liquor</label><select id="neo-prom-foul-liquor"><option value="no">No</option><option value="yes">Yes</option></select></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="neo-maternal-fever">Maternal Fever in Labour</label><select id="neo-maternal-fever"><option value="no">No</option><option value="yes">Yes</option></select></div>
            <div class="form-group"><label for="neo-gbs">GBS Status</label><select id="neo-gbs"><option value="unknown">Unknown</option><option value="negative">Negative</option><option value="positive">Positive</option></select></div>
        </div>
        <div class="form-group"><label for="neo-maternal-illness">Significant Maternal Illness/Medication</label><textarea id="neo-maternal-illness" rows="2"></textarea></div>
    </div>

    <div class="card">
        <h2 class="card-title">Delivery &amp; Immediate Neonatal Details</h2>
        <div class="form-row">
            <div class="form-group"><label for="neo-delivery-mode">Mode of Delivery</label><select id="neo-delivery-mode"><option value="">Select...</option><option value="svd">SVD</option><option value="lscs">LSCS</option><option value="assisted">Assisted (vacuum/forceps)</option></select></div>
            <div class="form-group" id="neo-lscs-indication-group" style="display:none;"><label for="neo-lscs-indication">LSCS Indication</label><input type="text" id="neo-lscs-indication"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="neo-ga-lmp-weeks">GA by LMP (weeks)</label><input type="number" id="neo-ga-lmp-weeks" step="0.5" min="20" max="45" onchange="classifyNewborn()"></div>
            <div class="form-group"><label for="neo-ga-ballard">GA by Ballard (weeks)</label><input type="number" id="neo-ga-ballard" step="0.5" min="20" max="45" onchange="classifyNewborn()"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="neo-birth-weight">Birth Weight (g)</label><input type="number" id="neo-birth-weight" min="0" onchange="classifyNewborn()"></div>
            <div class="form-group"><label for="neo-birth-length">Birth Length (cm)</label><input type="number" id="neo-birth-length" step="0.5"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="neo-birth-hc">Head Circumference (cm)</label><input type="number" id="neo-birth-hc" step="0.5"></div>
            <div class="form-group"><label for="neo-sex">Sex</label><select id="neo-sex"><option value="">Select...</option><option value="male">Male</option><option value="female">Female</option><option value="ambiguous">Ambiguous</option></select></div>
        </div>
        <div class="card" style="margin:10px 0;padding:15px;background:var(--bg-color);">
            <strong>Newborn Classification:</strong><br>
            <span id="neo-classification-text" style="font-size:0.95rem;">Enter birth weight and gestational age above to auto-classify</span>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="neo-apgar1">APGAR at 1 min</label><input type="number" id="neo-apgar1" min="0" max="10"></div>
            <div class="form-group"><label for="neo-apgar5">APGAR at 5 min</label><input type="number" id="neo-apgar5" min="0" max="10"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="neo-resuscitation">Resuscitation Needed</label><select id="neo-resuscitation" onchange="toggleResuscitationDetails()"><option value="no">No</option><option value="yes">Yes</option></select></div>
            <div class="form-group"><label for="neo-cried-immediately">Cried Immediately</label><select id="neo-cried-immediately"><option value="yes">Yes</option><option value="no">No</option></select></div>
        </div>
        <div id="neo-resuscitation-details" style="display:none;">
            <div class="form-group"><label>Resuscitation Details</label>
                <div class="checkbox-group">
                    <label class="checkbox-item"><input type="checkbox" name="neo-resus-detail" value="stimulation"> Stimulation</label>
                    <label class="checkbox-item"><input type="checkbox" name="neo-resus-detail" value="bag-mask"> Bag &amp; Mask</label>
                    <label class="checkbox-item"><input type="checkbox" name="neo-resus-detail" value="intubation"> Intubation</label>
                    <label class="checkbox-item"><input type="checkbox" name="neo-resus-detail" value="chest-compressions"> Chest Compressions</label>
                    <label class="checkbox-item"><input type="checkbox" name="neo-resus-detail" value="adrenaline"> Adrenaline</label>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <h2 class="card-title">Neonatal Physical Examination</h2>
        <div class="form-row four-col">
            <div class="form-group"><label>Temperature (¬∞C)</label><input type="number" id="neo-temperature" step="0.1"></div>
            <div class="form-group"><label>Heart Rate (bpm)</label><input type="number" id="neo-hr"></div>
            <div class="form-group"><label>RR (/min)</label><input type="number" id="neo-rr"></div>
            <div class="form-group"><label>SpO‚ÇÇ (%)</label><input type="number" id="neo-spo2" min="0" max="100"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="neo-weight-exam">Current Weight (g)</label><input type="number" id="neo-weight-exam"></div>
            <div class="form-group"><label for="neo-weight-change">Weight Change</label><input type="text" id="neo-weight-change" placeholder="e.g., ‚Üì 5% from birth weight" readonly></div>
        </div>
        <div class="form-group"><label for="neo-general-exam">General Appearance</label><select id="neo-general-exam"><option value="">Select...</option><option value="well">Well, pink, active</option><option value="pale">Pale, quiet</option><option value="jaundiced">Jaundiced</option><option value="cyanosed">Cyanosed</option><option value="lethargic">Lethargic</option></select></div>
        <div class="form-row">
            <div class="form-group"><label for="neo-jaundice">Jaundice</label><select id="neo-jaundice"><option value="no">No</option><option value="face">Face only (Zone 1)</option><option value="chest">To chest (Zone 2)</option><option value="abdomen">To abdomen (Zone 3)</option><option value="limbs">To limbs (Zone 4)</option><option value="palms-soles">Palms &amp; Soles (Zone 5)</option></select></div>
            <div class="form-group"><label for="neo-bilirubin">Serum Bilirubin (Œºmol/L or mg/dL)</label><input type="text" id="neo-bilirubin" placeholder="Enter value and units"></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="neo-fontanelle">Anterior Fontanelle</label><select id="neo-fontanelle"><option value="">Select...</option><option value="open-flat">Open &amp; Flat</option><option value="open-sunken">Sunken</option><option value="open-bulging">Bulging</option></select></div>
            <div class="form-group"><label for="neo-skin">Skin</label><select id="neo-skin"><option value="normal">Normal</option><option value="milia">Milia</option><option value="erythema-toxicum">Erythema Toxicum</option><option value="vernix">Vernix Caseosa</option><option value="lanugo">Lanugo</option></select></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="neo-umbilicus">Umbilicus</label><select id="neo-umbilicus"><option value="normal">Normal / Drying</option><option value="red">Erythema (omphalitis?)</option><option value="discharge">Discharge</option><option value="hernia">Umbilical Hernia</option></select></div>
            <div class="form-group"><label for="neo-cord-vessels">Cord Vessels</label><select id="neo-cord-vessels"><option value="2v1a">2 veins, 1 artery (normal)</option><option value="1v1a">1 vein, 1 artery (single umbilical artery)</option></select></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="neo-palate">Palate</label><select id="neo-palate"><option value="intact">Intact</option><option value="cleft">Cleft palate</option></select></div>
            <div class="form-group"><label for="neo-hip">Hip Examination (Ortolani/Barlow)</label><select id="neo-hip"><option value="normal">Normal</option><option value="click">Click</option><option value="clunk">Clunk (abnormal)</option></select></div>
        </div>
        <div class="form-group"><label for="neo-congenital-anomalies">Congenital Anomalies</label><textarea id="neo-congenital-anomalies" rows="3" placeholder="None or describe any structural anomalies observed..."></textarea></div>
        <div class="form-group"><label for="neo-exam-additional">Additional Examination Findings</label><textarea id="neo-exam-additional" rows="3" placeholder="Chest, abdomen, genitalia, CNS, reflexes, tone..."></textarea></div>
    </div>

    <div class="card">
        <h2 class="card-title">Neonatal Primitive Reflexes</h2>
        <div class="form-row">
            <div class="form-group"><label for="neo-moro">Moro Reflex</label><select id="neo-moro"><option value="">--</option><option value="present">Present</option><option value="absent">Absent</option><option value="asymmetric">Asymmetric</option></select></div>
            <div class="form-group"><label for="neo-rooting">Rooting Reflex</label><select id="neo-rooting"><option value="">--</option><option value="present">Present</option><option value="absent">Absent</option></select></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="neo-sucking">Sucking Reflex</label><select id="neo-sucking"><option value="">--</option><option value="present">Present, strong</option><option value="weak">Present, weak</option><option value="absent">Absent</option></select></div>
            <div class="form-group"><label for="neo-grasp">Palmar Grasp</label><select id="neo-grasp"><option value="">--</option><option value="present">Present</option><option value="absent">Absent</option></select></div>
        </div>
        <div class="form-row">
            <div class="form-group"><label for="neo-stepping">Stepping Reflex</label><select id="neo-stepping"><option value="">--</option><option value="present">Present</option><option value="absent">Absent</option></select></div>
            <div class="form-group"><label for="neo-muscle-tone">Muscle Tone</label><select id="neo-muscle-tone"><option value="">--</option><option value="normal">Normal</option><option value="hypotonic">Hypotonic</option><option value="hypertonic">Hypertonic</option></select></div>
        </div>
    </div>

    <div class="card">
        <h2 class="card-title">Neonatal Medications</h2>
        <div class="table-responsive">
            <table id="neo-medications-table">
                <thead><tr><th>Drug</th><th>Indication</th><th>Dose</th><th>Route</th><th>Frequency</th><th></th></tr></thead>
                <tbody><tr>
                    <td><input type="text" placeholder="e.g., Ampicillin"></td>
                    <td><input type="text" placeholder="Indication"></td>
                    <td><input type="text" placeholder="Dose (mg/kg)"></td>
                    <td><select><option>IV</option><option>PO</option><option>IM</option></select></td>
                    <td><input type="text" placeholder="Q12h"></td>
                    <td><button class="remove-row-btn" onclick="removeRow(this)">√ó</button></td>
                </tr></tbody>
            </table>
        </div>
        <button class="add-row-btn" onclick="addNeoMedicationRow()">+ Add Medication</button>
    </div>

    <div class="card">
        <h2 class="card-title">Neonatal Diagnosis &amp; Plan</h2>
        <div class="form-group"><label for="neo-diagnosis">Neonatal Diagnoses</label><textarea id="neo-diagnosis" rows="4" placeholder="1. &#10;2. &#10;3."></textarea></div>
        <div class="form-group"><label for="neo-plan">Management Plan</label><textarea id="neo-plan" rows="5" placeholder="Fluids, nutrition, monitoring, medications, screening..."></textarea></div>
        <div class="form-group"><label for="neo-family-counseling">Family Counseling</label><textarea id="neo-family-counseling" rows="3" placeholder="Key points discussed with parents..."></textarea></div>
    </div>
</div>

<!-- Toast Notification -->
<div class="toast" id="toast">Notification</div>

<!-- Action Buttons -->
<div class="action-buttons">
    <button class="btn btn-success" onclick="saveData()">üíæ Save</button>
    <button class="btn btn-primary" onclick="exportPDF()">üñ® Print / PDF</button>
    <button class="btn btn-danger" onclick="clearForm()">üóë Clear</button>
</div>

</div><!-- end .container -->

<script>
// ============================================================
// PEDIATRICS CLERKSHIP SHEET ‚Äî FIXED & ENHANCED JAVASCRIPT
// ============================================================

// ‚îÄ‚îÄ TAB NAVIGATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showTab(tabId, el) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  const content = document.getElementById(tabId);
  if (content) content.classList.add('active');
  if (el) el.classList.add('active');
  updateProgress();
  localStorage.setItem('currentTab', tabId);
  window.scrollTo(0, 0);
  // Sync summary panel whenever Final Diff Dx tab is shown
  if (tabId === 'diff-dx-final') syncSummaryPanel();
}

// ‚îÄ‚îÄ AGE CALCULATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function calculateAge() {
  const dob = document.getElementById('dob')?.value;
  if (!dob) return;
  const birthDate = new Date(dob);
  const today = new Date();
  let years = today.getFullYear() - birthDate.getFullYear();
  let months = today.getMonth() - birthDate.getMonth();
  let days = today.getDate() - birthDate.getDate();
  if (days < 0) { months--; days += new Date(today.getFullYear(), today.getMonth(), 0).getDate(); }
  if (months < 0) { years--; months += 12; }
  const ageEl = document.getElementById('age');
  if (ageEl) {
    if (years === 0 && months === 0) ageEl.value = `${days} days`;
    else if (years === 0) ageEl.value = `${months} months, ${days} days`;
    else ageEl.value = `${years} years, ${months} months, ${days} days`;
  }
  recalcMaintenanceFluids();
}

// ‚îÄ‚îÄ NEONATAL AGE CALCULATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function calculateNeoAge() {
  const dob = document.getElementById('neo-dob')?.value;
  const doa = document.getElementById('neo-doa')?.value;
  const tob = document.getElementById('neo-tob')?.value;
  const toa = document.getElementById('neo-toa')?.value;
  if (!dob) return;
  const birthDT = new Date(`${dob}T${tob || '00:00'}`);
  const admitDT = doa ? new Date(`${doa}T${toa || '00:00'}`) : new Date();
  const diffMs = admitDT - birthDT;
  if (diffMs < 0) return;
  const totalMins = Math.floor(diffMs / 60000);
  const hrs = Math.floor(totalMins / 60);
  const mins = totalMins % 60;
  const days = Math.floor(hrs / 24);
  const remHrs = hrs % 24;
  let txt = '';
  if (days > 0) txt = `${days} day${days>1?'s':''}, ${remHrs} hr${remHrs!==1?'s':''}`;
  else txt = `${hrs} hr${hrs!==1?'s':''}, ${mins} min${mins!==1?'s':''}`;
  const el = document.getElementById('neo-age-admission');
  if (el) el.value = txt;
}

// ‚îÄ‚îÄ NEWBORN CLASSIFICATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function classifyNewborn() {
  const bwEl = document.getElementById('neo-birth-weight') || document.getElementById('neo-birth-weight-exam');
  const gaEl = document.getElementById('neo-ga-lmp-weeks') || document.getElementById('neo-ga-ballard');
  const bw = parseFloat(bwEl?.value);
  const ga = parseFloat(gaEl?.value);
  const resultEl = document.getElementById('neo-classification-text');
  if (!resultEl) return;
  if (!bw && !ga) { resultEl.innerHTML = 'Enter birth weight and gestational age to classify'; return; }

  const lines = [];

  // Weight classification
  if (!isNaN(bw)) {
    if (bw < 1000) lines.push('<span style="color:#e74c3c;font-weight:600;">Extremely Low Birth Weight (ELBW) &lt;1000g</span>');
    else if (bw < 1500) lines.push('<span style="color:#e74c3c;font-weight:600;">Very Low Birth Weight (VLBW) 1000‚Äì1499g</span>');
    else if (bw < 2500) lines.push('<span style="color:#f39c12;font-weight:600;">Low Birth Weight (LBW) 1500‚Äì2499g</span>');
    else if (bw <= 4000) lines.push('<span style="color:#27ae60;font-weight:600;">Normal Birth Weight 2500‚Äì4000g</span>');
    else lines.push('<span style="color:#f39c12;font-weight:600;">Macrosomia &gt;4000g</span>');
  }

  // Gestational age classification
  if (!isNaN(ga)) {
    if (ga < 28) lines.push('Extreme Prematurity (&lt;28 weeks)');
    else if (ga < 32) lines.push('Very Preterm (28‚Äì31 weeks)');
    else if (ga < 34) lines.push('Moderate Preterm (32‚Äì33 weeks)');
    else if (ga < 37) lines.push('Late Preterm (34‚Äì36 weeks)');
    else if (ga <= 41) lines.push('<span style="color:#27ae60;">Term (37‚Äì41 weeks)</span>');
    else lines.push('Post-term (&gt;41 weeks)');
  }

  // SGA/AGA/LGA (simplified, using birth weight + GA)
  if (!isNaN(bw) && !isNaN(ga)) {
    // Approximate 10th and 90th percentile thresholds
    const p10 = ga < 28 ? 700 : ga < 32 ? 1000 : ga < 34 ? 1400 : ga < 36 ? 1800 : ga < 38 ? 2300 : 2500;
    const p90 = ga < 28 ? 1100 : ga < 32 ? 1700 : ga < 34 ? 2100 : ga < 36 ? 2700 : ga < 38 ? 3300 : 4000;
    if (bw < p10) lines.push('<span style="color:#e74c3c;">Small for Gestational Age (SGA) ‚Äî &lt;10th percentile</span>');
    else if (bw > p90) lines.push('Large for Gestational Age (LGA) ‚Äî &gt;90th percentile');
    else lines.push('<span style="color:#27ae60;">Appropriate for Gestational Age (AGA)</span>');
  }

  resultEl.innerHTML = lines.join('<br>');
}

// ‚îÄ‚îÄ TOGGLE PROM DURATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function togglePromDuration() {
  const val = document.getElementById('neo-prom')?.value;
  const el = document.getElementById('neo-prom-details');
  if (el) el.style.display = val === 'yes' ? 'flex' : 'none';
}

// ‚îÄ‚îÄ TOGGLE RESUSCITATION DETAILS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleResuscitationDetails() {
  const val = document.getElementById('neo-resuscitation')?.value;
  const el = document.getElementById('neo-resuscitation-details');
  if (el) el.style.display = val === 'yes' ? 'block' : 'none';
}

// ‚îÄ‚îÄ GROWTH CALCULATIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function calculateGrowth() {
  const weight = parseFloat(document.getElementById('weight')?.value);
  const height = parseFloat(document.getElementById('height')?.value);
  if (!weight || !height) return;
  const heightM = height / 100;
  const bmi = (weight / (heightM * heightM)).toFixed(1);
  const bmiEl = document.getElementById('bmiValue');
  if (bmiEl) bmiEl.textContent = bmi;
  document.getElementById('growthDisplay').style.display = 'flex';
  document.getElementById('wfaPercentile').textContent = 'N/A*';
  document.getElementById('hfaPercentile').textContent = 'N/A*';
  recalcMaintenanceFluids();
}

// ‚îÄ‚îÄ MAINTENANCE FLUID CALCULATOR (Holliday-Segar) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function recalcMaintenanceFluids() {
  const w = parseFloat(document.getElementById('weight')?.value);
  const wEl = document.getElementById('maintenanceWeight');
  const flEl = document.getElementById('maintenanceFluid');
  const frEl = document.getElementById('maintenanceFluidRate');
  const dcEl = document.getElementById('doseCalcWeight');
  if (wEl) wEl.textContent = w ? `${w}` : '--';
  if (dcEl) dcEl.textContent = w ? `${w}` : '--';
  if (!w) { if(flEl) flEl.textContent='--'; if(frEl) frEl.textContent='--'; return; }
  let ml = 0;
  if (w <= 10) ml = w * 100;
  else if (w <= 20) ml = 1000 + (w - 10) * 50;
  else ml = 1500 + (w - 20) * 20;
  if (flEl) flEl.textContent = Math.round(ml);
  if (frEl) frEl.textContent = (ml / 24).toFixed(1);
}

// ‚îÄ‚îÄ DOSE CALCULATOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setupDoseCalculator() {
  const mgKgEl = document.getElementById('doseCalcMgKg');
  if (!mgKgEl) return;
  mgKgEl.addEventListener('input', function() {
    const w = parseFloat(document.getElementById('weight')?.value);
    const dose = parseFloat(this.value);
    const totalEl = document.getElementById('doseCalcTotal');
    if (totalEl) totalEl.textContent = (w && dose) ? (w * dose).toFixed(1) : '--';
  });
}

// ‚îÄ‚îÄ VITAL SIGN INTERPRETATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function interpretVitalSign(type) {
  // Get patient age in months for age-appropriate ranges
  const ageText = document.getElementById('age')?.value || '';
  const ageMatch = ageText.match(/(\d+)\s*year/);
  const ageYears = ageMatch ? parseInt(ageMatch[1]) : 5; // default 5y if unknown

  const ranges = {
    temperature: { low: 36.5, high: 37.5, dangerHigh: 38.5, dangerLow: 36.0, id: 'temperature', indicatorId: 'tempInterpretation' },
    hr: {
      // Age-based HR ranges (bpm)
      low: ageYears < 1 ? 100 : ageYears < 3 ? 90 : ageYears < 6 ? 80 : ageYears < 12 ? 70 : 60,
      high: ageYears < 1 ? 160 : ageYears < 3 ? 150 : ageYears < 6 ? 120 : ageYears < 12 ? 110 : 100,
      dangerHigh: ageYears < 1 ? 180 : 160, dangerLow: ageYears < 1 ? 80 : 50,
      id: 'heartRate', indicatorId: 'hrInterpretation'
    },
    rr: {
      low: ageYears < 1 ? 30 : ageYears < 5 ? 24 : ageYears < 12 ? 18 : 12,
      high: ageYears < 1 ? 60 : ageYears < 5 ? 40 : ageYears < 12 ? 30 : 20,
      dangerHigh: ageYears < 1 ? 70 : 50, dangerLow: 5,
      id: 'respiratoryRate', indicatorId: 'rrInterpretation'
    },
    spo2: { low: 95, high: 100, dangerLow: 92, dangerHigh: 101, id: 'oxygenSaturation', indicatorId: 'spo2Interpretation' }
  };

  const r = ranges[type];
  if (!r) return;
  const val = parseFloat(document.getElementById(r.id)?.value);
  const indicator = document.getElementById(r.indicatorId);
  if (!indicator || isNaN(val)) return;

  indicator.className = 'vital-indicator';
  if (type === 'spo2') {
    if (val >= r.low) indicator.classList.add('vital-normal');
    else if (val >= r.dangerLow) indicator.classList.add('vital-warning');
    else indicator.classList.add('vital-danger');
  } else {
    if (val >= r.low && val <= r.high) indicator.classList.add('vital-normal');
    else if (val < r.dangerLow || val > r.dangerHigh) indicator.classList.add('vital-danger');
    else indicator.classList.add('vital-warning');
  }
  indicator.style.display = 'inline-block';
}

// ‚îÄ‚îÄ CBC INTERPRETATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function interpretLabs() {
  const labs = [
    { id: 'wbc', low: 4, high: 11, interp: 'wbcInterpretation', unit: '√ó10‚Åπ/L', lowLabel: 'Leukopenia', highLabel: 'Leukocytosis' },
    { id: 'hgb', low: 11, high: 16, interp: 'hgbInterpretation', unit: 'g/dL', lowLabel: 'Anemia', highLabel: 'Polycythemia' },
    { id: 'platelets', low: 150, high: 400, interp: 'plateletsInterpretation', unit: '√ó10‚Åπ/L', lowLabel: 'Thrombocytopenia', highLabel: 'Thrombocytosis' },
    { id: 'neutrophils', low: 40, high: 70, interp: 'neutrophilsInterpretation', unit: '%', lowLabel: 'Neutropenia', highLabel: 'Neutrophilia' },
    { id: 'lymphocytes', low: 20, high: 45, interp: 'lymphocytesInterpretation', unit: '%', lowLabel: 'Lymphopenia', highLabel: 'Lymphocytosis' },
    { id: 'glucose', low: 60, high: 100, interp: 'glucoseInterpretation', unit: 'mg/dL', lowLabel: 'Hypoglycemia', highLabel: 'Hyperglycemia' },
    { id: 'sodium', low: 135, high: 145, interp: 'sodiumInterpretation', unit: 'mEq/L', lowLabel: 'Hyponatremia', highLabel: 'Hypernatremia' },
    { id: 'potassium', low: 3.5, high: 5.0, interp: 'potassiumInterpretation', unit: 'mEq/L', lowLabel: 'Hypokalemia', highLabel: 'Hyperkalemia' },
    { id: 'creatinine', low: 0.2, high: 0.9, interp: 'creatinineInterpretation', unit: 'mg/dL', lowLabel: 'Low', highLabel: 'Elevated (AKI?)' },
  ];
  labs.forEach(lab => {
    const el = document.getElementById(lab.id);
    const intEl = document.getElementById(lab.interp);
    if (!el || !intEl) return;
    el.addEventListener('input', function() {
      const val = parseFloat(this.value);
      if (isNaN(val)) { intEl.textContent = '--'; intEl.style.color = ''; return; }
      if (val < lab.low) { intEl.textContent = `‚Üì ${lab.lowLabel}`; intEl.style.color = 'var(--accent-color)'; }
      else if (val > lab.high) { intEl.textContent = `‚Üë ${lab.highLabel}`; intEl.style.color = 'var(--warning-color)'; }
      else { intEl.textContent = '‚úì Normal'; intEl.style.color = 'var(--success-color)'; }
    });
  });
}

// ‚îÄ‚îÄ SYNC SUMMARY PANEL (Diff Dx Final) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function syncSummaryPanel() {
  const map = { summaryHistKey1: 'keyFeature1', summaryHistKey2: 'keyFeature2', summaryHistKey3: 'keyFeature3' };
  Object.entries(map).forEach(([spanId, inputId]) => {
    const span = document.getElementById(spanId);
    const input = document.getElementById(inputId);
    if (span && input) span.textContent = input.value || '--';
  });
  // Sync differential names in comparison table
  const dx = ['histDx1', 'histDx2', 'histDx3'];
  const spans = ['compareDx1', 'compareDx2', 'compareDx3'];
  dx.forEach((id, i) => {
    const inp = document.getElementById(id);
    const span = document.getElementById(spans[i]);
    if (inp && span) span.textContent = inp.value || `Dx #${i+1}`;
  });
}

// ‚îÄ‚îÄ ADD ROW FUNCTIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function cloneFirstRow(tableId, clearValues = true) {
  const table = document.getElementById(tableId);
  if (!table) return null;
  const tbody = table.querySelector('tbody');
  const firstRow = tbody.rows[0];
  const newRow = firstRow.cloneNode(true);
  if (clearValues) {
    newRow.querySelectorAll('input').forEach(i => i.value = '');
    newRow.querySelectorAll('select').forEach(s => s.selectedIndex = 0);
    newRow.querySelectorAll('textarea').forEach(t => t.value = '');
  }
  return { tbody, newRow };
}

function addTreatmentRow() {
  const r = cloneFirstRow('priorTreatmentTable');
  if (r) r.tbody.appendChild(r.newRow);
}
function addIllnessRow() {
  const r = cloneFirstRow('pastIllnessTable');
  if (r) r.tbody.appendChild(r.newRow);
}
function addMedicationRow() {
  const r = cloneFirstRow('currentMedsTable');
  if (r) r.tbody.appendChild(r.newRow);
}
function addSiblingRow() {
  const r = cloneFirstRow('siblingsTable');
  if (r) {
    r.newRow.cells[0].textContent = r.tbody.rows.length + 1;
    r.tbody.appendChild(r.newRow);
  }
}
function addMedicationManagementRow() {
  const r = cloneFirstRow('medicationsTable');
  if (r) r.tbody.appendChild(r.newRow);
}
function addInvestigationPlanRow() {
  const r = cloneFirstRow('investigationPlanTable');
  if (r) r.tbody.appendChild(r.newRow);
}
function addNeoMedicationRow() {
  const r = cloneFirstRow('neo-medications-table');
  if (r) r.tbody.appendChild(r.newRow);
}

function removeRow(btn) {
  const row = btn.closest('tr');
  const tbody = row?.parentElement;
  if (!tbody || tbody.children.length <= 1) { showToast('Cannot remove the last row', 'warning'); return; }
  row.remove();
}

// ‚îÄ‚îÄ ADD PROGRESS NOTE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function addProgressNote() {
  const container = document.getElementById('progressNotesContainer');
  if (!container) return;
  const noteCount = container.querySelectorAll('.card').length + 1;
  const today = new Date().toISOString().split('T')[0];
  const now = new Date().toTimeString().slice(0,5);

  const div = document.createElement('div');
  div.className = 'card';
  div.style.cssText = 'background: var(--card-bg); border-left: 4px solid var(--secondary-color); margin-top: 20px;';
  div.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
      <h3 style="color:var(--secondary-color);margin:0;">Progress Note #${noteCount}</h3>
      <button class="remove-row-btn" style="padding:6px 12px;" onclick="this.closest('.card').remove()">‚úï Remove</button>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Date</label><input type="date" class="progress-date" value="${today}"></div>
      <div class="form-group"><label>Time</label><input type="time" class="progress-time" value="${now}"></div>
    </div>
    <h4 style="margin:15px 0 10px;color:var(--primary-color);">S ‚Äî SUBJECTIVE</h4>
    <div class="form-group"><label>Caregiver Concerns / Symptoms Today</label>
      <textarea class="progress-subjective" rows="2" placeholder="How is the child today?"></textarea></div>
    <div class="form-row three-col">
      <div class="form-group"><label>Feeding</label>
        <select class="progress-feeding"><option value="">Select...</option><option>Feeding Well</option><option>Feeding Poorly</option><option>Refusing</option></select></div>
      <div class="form-group"><label>Urine Output</label>
        <select class="progress-urine"><option value="">Select...</option><option>Adequate</option><option>Decreased</option><option>None</option></select></div>
      <div class="form-group"><label>Activity Level</label>
        <select class="progress-activity"><option value="">Select...</option><option>Active/Playful</option><option>Quiet</option><option>Lethargic</option></select></div>
    </div>
    <h4 style="margin:15px 0 10px;color:var(--primary-color);">O ‚Äî OBJECTIVE</h4>
    <div class="form-group"><label>Vital Signs</label>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:10px;">
        <input type="number" class="progress-temp" placeholder="T ¬∞C" step="0.1">
        <input type="number" class="progress-hr" placeholder="HR bpm">
        <input type="number" class="progress-rr" placeholder="RR /min">
        <input type="text" class="progress-bp" placeholder="BP mmHg">
        <input type="number" class="progress-spo2" placeholder="SpO‚ÇÇ %">
      </div></div>
    <div class="form-group"><label>Examination Findings</label>
      <textarea class="progress-exam" rows="3" placeholder="Brief exam findings..."></textarea></div>
    <div class="form-group"><label>Investigation Results Today</label>
      <textarea class="progress-investigations" rows="2" placeholder="New results..."></textarea></div>
    <h4 style="margin:15px 0 10px;color:var(--primary-color);">A ‚Äî ASSESSMENT</h4>
    <div class="form-row">
      <div class="form-group"><label>Current Diagnosis</label><input type="text" class="progress-diagnosis" placeholder="Working diagnosis"></div>
      <div class="form-group"><label>Clinical Status</label>
        <select class="progress-status"><option value="">Select...</option><option>Improving</option><option>Stable</option><option>Unchanged</option><option>Worsening</option><option>Deteriorating</option></select></div>
    </div>
    <div class="form-group"><label>Assessment Summary</label>
      <textarea class="progress-assessment" rows="2"></textarea></div>
    <h4 style="margin:15px 0 10px;color:var(--primary-color);">P ‚Äî PLAN</h4>
    <div class="form-group"><label>Continue</label><textarea class="progress-continue" rows="2"></textarea></div>
    <div class="form-group"><label>Modify</label><textarea class="progress-modify" rows="2"></textarea></div>
    <div class="form-group"><label>New Orders</label><textarea class="progress-new-orders" rows="2"></textarea></div>
    <div class="form-group"><label>Clerk/Student Name</label><input type="text" class="progress-clerk" placeholder="Your name"></div>`;
  container.appendChild(div);
  div.scrollIntoView({ behavior: 'smooth' });
}

// ‚îÄ‚îÄ DISCHARGE DAYS CALCULATOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function calcDischargeDays() {
  const admEl = document.getElementById('admissionDate');
  const disEl = document.getElementById('dischargeDate');
  const totalEl = document.getElementById('totalDaysAdmitted');
  if (!admEl || !disEl || !totalEl) return;
  if (admEl.value && disEl.value) {
    const diff = (new Date(disEl.value) - new Date(admEl.value)) / 86400000;
    totalEl.value = diff >= 0 ? Math.round(diff) : '';
  }
}

// ‚îÄ‚îÄ CONDITIONAL DISPLAY HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function wireConditional(triggerEl, targetId, showValue) {
  if (!triggerEl) return;
  const target = document.getElementById(targetId);
  if (!target) return;
  const check = () => { target.style.display = triggerEl.value === showValue ? 'block' : 'none'; };
  triggerEl.addEventListener('change', check);
  check();
}

function setupConditionals() {
  wireConditional(document.getElementById('deliveryMode'), 'csectionIndicationGroup', 'csection');
  wireConditional(document.getElementById('nicuAdmission'), 'nicuReasonGroup', 'yes');
  wireConditional(document.getElementById('devRegression'), 'devRegressionDetailsGroup', 'yes');
  wireConditional(document.getElementById('consanguinity'), 'consanguinityDegreeGroup', 'yes');
  wireConditional(document.getElementById('rashPresent'), 'rashDetailsGroup', 'yes');
  wireConditional(document.getElementById('abdTenderness'), 'tendernessLocationGroup', 'yes');
  wireConditional(document.getElementById('murmur'), 'murmurDetails', 'yes');
  wireConditional(document.getElementById('admissionDecision'), 'wardGroup', 'admit');
  wireConditional(document.getElementById('chestXray'), 'chestXrayFindingsGroup', 'done');
  wireConditional(document.getElementById('ultrasound'), 'ultrasoundFindingsGroup', 'done');

  // Oxygen support ‚Üí show flow rate
  const o2Support = document.getElementById('oxygenSupport');
  const o2Flow = document.getElementById('oxygenFlow');
  if (o2Support && o2Flow) {
    o2Support.addEventListener('change', () => {
      o2Flow.style.display = o2Support.value === 'oxygen' ? 'inline-block' : 'none';
    });
  }

  // LSCS indication
  const neoDelivery = document.getElementById('neo-delivery-mode');
  const neoLscsGroup = document.getElementById('neo-lscs-indication-group');
  if (neoDelivery && neoLscsGroup) {
    neoDelivery.addEventListener('change', () => {
      neoLscsGroup.style.display = neoDelivery.value === 'lscs' ? 'block' : 'none';
    });
  }

  // Discharge date ‚Üí calc days
  document.getElementById('dischargeDate')?.addEventListener('change', calcDischargeDays);
  document.getElementById('admissionDate')?.addEventListener('change', calcDischargeDays);

  // Weight change ‚Üí recalc fluids & dose
  document.getElementById('weight')?.addEventListener('input', recalcMaintenanceFluids);
}

// ‚îÄ‚îÄ AUTO-POPULATE Diff Dx name links ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setupDiffDxLinks() {
  [1,2,3].forEach(i => {
    document.getElementById(`histDx${i}`)?.addEventListener('input', function() {
      const el = document.getElementById(`lookForDx${i}`);
      if (el) el.textContent = this.value || `Dx #${i}`;
    });
    document.getElementById(`histDx${i}`)?.addEventListener('input', syncSummaryPanel);
    document.getElementById(`keyFeature${i}`)?.addEventListener('input', syncSummaryPanel);
  });
}

// ‚îÄ‚îÄ ADD DIFFERENTIAL DIAGNOSIS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function addDifferential(section) {
  const container = section === 'history'
    ? document.querySelector('#diff-dx-history .card:nth-of-type(2)')
    : document.querySelector('#diff-dx-final .card:nth-of-type(4)');
  if (!container) return;
  const existing = container.querySelectorAll('.diff-dx-item').length;
  const num = existing + 1;
  const div = document.createElement('div');
  div.className = 'diff-dx-item';
  div.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h4 style="margin-bottom:10px;color:var(--primary-color);">Differential #${num}</h4>
      <button class="remove-row-btn" onclick="this.closest('.diff-dx-item').remove()">‚úï</button>
    </div>
    <div class="form-group"><label>Diagnosis</label><input type="text" placeholder="Diagnosis"></div>
    <div class="form-group"><label>Supporting Features</label><textarea rows="2"></textarea></div>
    <div class="form-group"><label>Features Against</label><textarea rows="2"></textarea></div>`;
  // Insert before the add button
  const btn = container.querySelector('.btn-outline');
  container.insertBefore(div, btn);
}

// ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateProgress() {
  const allInputs = document.querySelectorAll('input:not([type="checkbox"]):not([type="radio"]):not([readonly]), select, textarea');
  let filled = 0;
  allInputs.forEach(inp => { if (inp.value && inp.value.trim() !== '') filled++; });
  const pct = allInputs.length ? (filled / allInputs.length) * 100 : 0;
  const fill = document.getElementById('progressFill');
  if (fill) fill.style.width = pct.toFixed(1) + '%';
}

// ‚îÄ‚îÄ AUTOSAVE / SAVE / LOAD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let autoSaveTimer = null;
function scheduleAutoSave() {
  clearTimeout(autoSaveTimer);
  autoSaveTimer = setTimeout(() => { autoSave(true); }, 2000);
}

function autoSave(silent = false) {
  const indicator = document.getElementById('autosaveIndicator');
  if (!silent && indicator) {
    indicator.classList.add('saving');
    indicator.textContent = 'Saving‚Ä¶';
    indicator.style.display = 'block';
  }
  try {
    const data = gatherFormData();
    localStorage.setItem('pediatricsClerkshipData', JSON.stringify(data));
    if (!silent && indicator) {
      setTimeout(() => {
        indicator.classList.remove('saving');
        indicator.textContent = '‚úì Saved';
        setTimeout(() => { indicator.style.display = 'none'; }, 2000);
      }, 400);
    }
  } catch (e) {
    console.error('Autosave error:', e);
    if (!silent && indicator) {
      indicator.textContent = '‚ö† Save failed';
      setTimeout(() => { indicator.style.display = 'none'; }, 3000);
    }
  }
}

function gatherFormData() {
  const data = { _version: 2, lastSaved: new Date().toISOString() };
  document.querySelectorAll('[id]').forEach(el => {
    if (!el.id) return;
    if (el.tagName === 'INPUT' && el.type === 'checkbox') data[el.id] = el.checked;
    else if (el.tagName === 'INPUT' || el.tagName === 'SELECT' || el.tagName === 'TEXTAREA') data[el.id] = el.value;
  });
  // Named checkboxes (no id)
  document.querySelectorAll('input[type="checkbox"][name]').forEach(cb => {
    data[`cb_${cb.name}_${cb.value}`] = cb.checked;
  });
  data._tables = {
    priorTreatment: getTableData('priorTreatmentTable'),
    pastIllness: getTableData('pastIllnessTable'),
    currentMeds: getTableData('currentMedsTable'),
    siblings: getTableData('siblingsTable'),
    medications: getTableData('medicationsTable'),
    investigationPlan: getTableData('investigationPlanTable'),
    neoMeds: getTableData('neo-medications-table'),
  };
  return data;
}

function getTableData(tableId) {
  const table = document.getElementById(tableId);
  if (!table) return [];
  return Array.from(table.querySelectorAll('tbody tr')).map(row =>
    Array.from(row.querySelectorAll('input, select, textarea')).map(el =>
      el.type === 'checkbox' ? el.checked : el.value
    )
  ).filter(r => r.some(v => v !== '' && v !== false));
}

function saveData() {
  autoSave(false);
  showToast('‚úì Data saved successfully!', 'success');
}

function loadData() {
  const raw = localStorage.getItem('pediatricsClerkshipData');
  if (!raw) return;
  try {
    const data = JSON.parse(raw);
    Object.keys(data).forEach(key => {
      if (key.startsWith('_')) return;
      if (key.startsWith('cb_')) {
        // named checkboxes
        const parts = key.split('_');
        const name = parts[1];
        const value = parts.slice(2).join('_');
        const cb = document.querySelector(`input[type="checkbox"][name="${name}"][value="${value}"]`);
        if (cb) cb.checked = data[key];
        return;
      }
      const el = document.getElementById(key);
      if (!el) return;
      if (el.tagName === 'INPUT' && el.type === 'checkbox') el.checked = data[key];
      else if (el.tagName === 'INPUT' || el.tagName === 'SELECT' || el.tagName === 'TEXTAREA') {
        el.value = data[key];
        el.dispatchEvent(new Event('change', { bubbles: true }));
      }
    });
    if (data.dob) calculateAge();
    if (data.weight && data.height) calculateGrowth();
    if (data['neo-dob']) calculateNeoAge();
    recalcMaintenanceFluids();
    updateProgress();
    const ts = data.lastSaved ? new Date(data.lastSaved).toLocaleString() : 'unknown';
    showToast(`‚úì Data restored (saved ${ts})`, 'success');
  } catch (e) {
    console.error('Load error:', e);
    showToast('‚ö† Could not restore saved data', 'error');
  }
}

// ‚îÄ‚îÄ CLEAR FORM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function clearForm() {
  if (!confirm('Clear all data? This cannot be undone.')) return;
  document.querySelectorAll('input, select, textarea').forEach(el => {
    if (el.type === 'checkbox' || el.type === 'radio') el.checked = false;
    else if (!el.hasAttribute('readonly')) el.value = '';
  });
  localStorage.removeItem('pediatricsClerkshipData');
  localStorage.removeItem('currentTab');
  updateProgress();
  showToast('Form cleared', 'success');
}

// ‚îÄ‚îÄ PDF EXPORT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function exportPDF() {
  // Collect patient name for filename
  const name = document.getElementById('patientName')?.value || 'Patient';
  const date = new Date().toISOString().split('T')[0];

  showToast('Preparing PDF ‚Äî please wait‚Ä¶', 'info');

  // Save current active tab, then reveal all tabs for printing
  const activeTab = document.querySelector('.tab-content.active')?.id;
  const allTabs = document.querySelectorAll('.tab-content');
  const navTabs = document.querySelectorAll('.nav-tabs, .action-buttons, .autosave-indicator');

  // Inject print-all styles
  const style = document.createElement('style');
  style.id = 'print-all-style';
  style.textContent = `
    @media print {
      body { background: white !important; color: black !important; font-size: 11px !important; }
      .header { position: static !important; }
      .nav-tabs, .action-buttons, .autosave-indicator, .btn, .remove-row-btn, .add-row-btn { display: none !important; }
      .tab-content { display: block !important; page-break-after: avoid; }
      .card { break-inside: avoid; page-break-inside: avoid; box-shadow: none !important; border: 1px solid #ccc !important; margin-bottom: 10px !important; }
      input, select, textarea { border: none !important; border-bottom: 1px solid #999 !important; background: transparent !important; color: black !important; font-size: 11px !important; }
      .diff-dx-card { background: #eee !important; color: black !important; }
      .summary-panel { background: #eee !important; color: black !important; }
      .growth-display, #growthDisplay { display: flex !important; }
      .alert { border: 1px solid #ccc !important; background: #f9f9f9 !important; }
      h1, h2, h3, h4, h5 { color: black !important; }
      .card-title::before { background: #333 !important; }
      @page { margin: 15mm; size: A4; }
    }`;
  document.head.appendChild(style);

  setTimeout(() => {
    window.print();
    // Restore after print dialog
    setTimeout(() => {
      document.getElementById('print-all-style')?.remove();
      showToast('‚úì Print dialog opened ‚Äî save as PDF', 'success');
    }, 1000);
  }, 300);
}

// ‚îÄ‚îÄ TOAST NOTIFICATIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showToast(message, type = 'info') {
  const toast = document.getElementById('toast');
  if (!toast) return;
  const colors = { success: '#27ae60', error: '#e74c3c', warning: '#f39c12', info: '#3498db' };
  toast.textContent = message;
  toast.style.borderLeft = `4px solid ${colors[type] || colors.info}`;
  toast.classList.add('show');
  clearTimeout(toast._timer);
  toast._timer = setTimeout(() => toast.classList.remove('show'), 3500);
}

// ‚îÄ‚îÄ DEHYDRATION CLASSIFICATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function classifyDehydration() {
  const g = document.getElementById('dehydGeneral')?.value;
  const e = document.getElementById('dehydEyes')?.value;
  const m = document.getElementById('dehydMouth')?.value;
  const s = document.getElementById('dehydSkin')?.value;
  const el = document.getElementById('dehydrationClassification');
  if (!el) return;
  let score = 0;
  if (g === 'lethargic') score += 2; else if (g === 'restless') score += 1;
  if (e === 'very-sunken') score += 2; else if (e === 'sunken') score += 1;
  if (m === 'very-dry') score += 2; else if (m === 'dry') score += 1;
  if (s === 'very-slow') score += 2; else if (s === 'slow') score += 1;
  if (score === 0) { el.textContent = 'No Dehydration'; el.style.color = 'var(--success-color)'; }
  else if (score <= 3) { el.textContent = 'Some Dehydration (Plan B)'; el.style.color = 'var(--warning-color)'; }
  else { el.textContent = 'Severe Dehydration (Plan C ‚Äî IV Fluids)'; el.style.color = 'var(--accent-color)'; }
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded', function () {
  setupConditionals();
  setupDiffDxLinks();
  setupDoseCalculator();
  interpretLabs();
  loadData();

  // Dehydration auto-classify
  ['dehydGeneral','dehydEyes','dehydMouth','dehydSkin','dehydThirst'].forEach(id => {
    document.getElementById(id)?.addEventListener('change', classifyDehydration);
  });

  // Auto-save on any input change
  document.addEventListener('input', () => { updateProgress(); scheduleAutoSave(); });
  document.addEventListener('change', () => { updateProgress(); scheduleAutoSave(); });

  // Restore last active tab
  const lastTab = localStorage.getItem('currentTab');
  const targetTab = (lastTab && document.getElementById(lastTab)) ? lastTab : 'patient-info';
  const matchingNav = Array.from(document.querySelectorAll('.nav-tab'))
    .find(t => t.getAttribute('onclick')?.includes(`'${targetTab}'`) || t.getAttribute('onclick')?.includes(`"${targetTab}"`));
  showTab(targetTab, matchingNav || document.querySelector('.nav-tab'));

  // Update nav tabs' onclick to pass `this`
  document.querySelectorAll('.nav-tab').forEach(btn => {
    const match = btn.getAttribute('onclick')?.match(/showTab\('([^']+)'\)/);
    if (match) {
      btn.setAttribute('onclick', `showTab('${match[1]}', this)`);
    }
  });
});

</script>
</body>
</html>
